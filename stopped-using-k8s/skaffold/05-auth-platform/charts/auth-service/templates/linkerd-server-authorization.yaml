apiVersion: policy.linkerd.io/v1beta1
kind: ServerAuthorization
metadata:
  name: {{ include "auth-service.fullname" . }}-allow-alt-apps
  namespace: {{ .Release.Namespace }}
  labels:
    {{- include "auth-service.labels" . | nindent 4 }}
    linkerd.policy/component: server-authorization
spec:
  server:
    name: {{ include "auth-service.fullname" . }}-http
  client:
    meshTLS:
      serviceAccounts:
        - name: alt-frontend       # SA 名（ログのIDと一致）
          namespace: alt-apps
        - name: alt-backend        # alt-backend経由のアクセス
          namespace: alt-apps
        - name: nginx-external     # ingress経由のアクセス
          namespace: alt-ingress
        - name: default            # nginx-external実際のSA
          namespace: alt-ingress
