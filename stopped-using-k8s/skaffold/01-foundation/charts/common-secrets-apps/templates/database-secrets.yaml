{{- if .Values.database.postgres.enabled }}
---
apiVersion: v1
kind: Secret
metadata:
  name: {{ .Values.database.postgres.secretName }}
  namespace: {{ .Values.namespace.database }}  # ROOT FIX: Create in alt-database namespace
  labels:
    {{- include "common-secrets.labels" . | nindent 4 }}
    app.kubernetes.io/component: database-postgres
  {{- with .Values.commonAnnotations }}
  annotations:
    {{- toYaml . | nindent 4 }}
  {{- end }}
type: Opaque
data:
  password: {{ .Values.database.postgres.password | b64enc | quote }}  # ROOT FIX: Add 'password' key for consistency with base64 encoding
  POSTGRES_PASSWORD: {{ .Values.database.postgres.password | b64enc | quote }}
  DB_PASSWORD: {{ .Values.database.postgres.password | b64enc | quote }}
  DB_APP_PASSWORD: {{ .Values.database.postgres.appPassword | b64enc | quote }}
{{- end }}

{{- if .Values.database.authPostgres.enabled }}
---
apiVersion: v1
kind: Secret
metadata:
  name: {{ .Values.database.authPostgres.secretName }}
  namespace: {{ .Values.namespace.auth }}  # ROOT FIX: Create in alt-auth namespace
  labels:
    {{- include "common-secrets.labels" . | nindent 4 }}
    app.kubernetes.io/component: database-auth-postgres
  {{- with .Values.commonAnnotations }}
  annotations:
    {{- toYaml . | nindent 4 }}
  {{- end }}
type: Opaque
data:
  password: {{ .Values.database.authPostgres.password | b64enc | quote }}  # ROOT FIX: Add 'password' key expected by auth-postgres with base64 encoding
  POSTGRES_PASSWORD: {{ .Values.database.authPostgres.password | b64enc | quote }}
{{- end }}

{{- if .Values.database.kratosPostgres.enabled }}
---
apiVersion: v1
kind: Secret
metadata:
  name: {{ .Values.database.kratosPostgres.secretName }}
  namespace: {{ .Values.namespace.auth }}  # ROOT FIX: Kratos also goes to alt-auth namespace
  labels:
    {{- include "common-secrets.labels" . | nindent 4 }}
    app.kubernetes.io/component: database-kratos-postgres
  {{- with .Values.commonAnnotations }}
  annotations:
    {{- toYaml . | nindent 4 }}
  {{- end }}
type: Opaque
data:
  password: {{ .Values.database.kratosPostgres.password | b64enc | quote }}  # ROOT FIX: Add 'password' key with base64 encoding
  POSTGRES_PASSWORD: {{ .Values.database.kratosPostgres.password | quote }}
{{- end }}

{{- if .Values.database.clickhouse.enabled }}
---
apiVersion: v1
kind: Secret
metadata:
  name: {{ .Values.database.clickhouse.secretName }}
  namespace: {{ .Values.namespace.analytics }}  # ROOT FIX: Create in alt-analytics namespace
  labels:
    {{- include "common-secrets.labels" . | nindent 4 }}
    app.kubernetes.io/component: database-clickhouse
  {{- with .Values.commonAnnotations }}
  annotations:
    {{- toYaml . | nindent 4 }}
  {{- end }}
type: Opaque
data:
  password: {{ .Values.database.clickhouse.password | b64enc | quote }}  # ROOT FIX: Use 'password' key expected by ClickHouse with base64 encoding
  CLICKHOUSE_PASSWORD: {{ .Values.database.clickhouse.password | quote }}
  APP_CLICKHOUSE_PASSWORD: {{ .Values.database.clickhouse.appPassword | quote }}
{{- end }}