apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "csr-controller.fullname" . }}-advanced-audit-system
  namespace: {{ .Release.Namespace }}
  labels:
    {{- include "csr-controller.labels" . | nindent 4 }}
    app.kubernetes.io/component: advanced-audit-system
spec:
  replicas: {{ .Values.advancedAuditSystem.replicas | default 2 }}
  selector:
    matchLabels:
      {{- include "csr-controller.selectorLabels" . | nindent 6 }}
      app.kubernetes.io/component: advanced-audit-system
  template:
    metadata:
      annotations:
        {{- with .Values.podAnnotations }}
        {{- toYaml . | nindent 8 }}
        {{- end }}
        prometheus.io/scrape: "true"
        prometheus.io/port: "8080"
        prometheus.io/path: "/metrics"
      labels:
        {{- include "csr-controller.selectorLabels" . | nindent 8 }}
        app.kubernetes.io/component: advanced-audit-system
    spec:
      {{- with .Values.imagePullSecrets }}
      imagePullSecrets:
        {{- toYaml . | nindent 8 }}
      {{- end }}
      serviceAccountName: {{ include "csr-controller.serviceAccountName" . }}
      securityContext:
        {{- toYaml .Values.podSecurityContext | nindent 8 }}
      containers:
      - name: advanced-audit-system
        securityContext:
          {{- toYaml .Values.securityContext | nindent 12 }}
        image: "{{ .Values.advancedAuditSystem.image.repository }}:{{ .Values.advancedAuditSystem.image.tag | default .Chart.AppVersion }}"
        imagePullPolicy: {{ .Values.advancedAuditSystem.image.pullPolicy }}
        env:
        - name: BLOCKCHAIN_AUDIT_ENABLED
          value: {{ .Values.advancedAuditSystem.blockchainAudit.enabled | default true | quote }}
        - name: AI_ANOMALY_DETECTION_ENABLED
          value: {{ .Values.advancedAuditSystem.aiAnomalyDetection.enabled | default true | quote }}
        - name: REAL_TIME_ANALYSIS_ENABLED
          value: {{ .Values.advancedAuditSystem.realTimeAnalysis.enabled | default true | quote }}
        - name: FORENSIC_ANALYSIS_ENABLED
          value: {{ .Values.advancedAuditSystem.forensicAnalysis.enabled | default true | quote }}
        - name: PREDICTIVE_ANALYTICS_ENABLED
          value: {{ .Values.advancedAuditSystem.predictiveAnalytics.enabled | default true | quote }}
        - name: AUDIT_TRAIL_INTEGRITY_ENABLED
          value: {{ .Values.advancedAuditSystem.auditTrailIntegrity.enabled | default true | quote }}
        - name: ADVANCED_REPORTING_ENABLED
          value: {{ .Values.advancedAuditSystem.advancedReporting.enabled | default true | quote }}
        - name: THREAT_HUNTING_ENABLED
          value: {{ .Values.advancedAuditSystem.threatHunting.enabled | default true | quote }}
        ports:
        - name: http
          containerPort: 8080
          protocol: TCP
        - name: grpc
          containerPort: 9090
          protocol: TCP
        - name: blockchain
          containerPort: 8545
          protocol: TCP
        - name: analytics
          containerPort: 8888
          protocol: TCP
        livenessProbe:
          httpGet:
            path: /healthz
            port: http
          initialDelaySeconds: 30
          periodSeconds: 10
        readinessProbe:
          httpGet:
            path: /ready
            port: http
          initialDelaySeconds: 5
          periodSeconds: 5
        resources:
          {{- toYaml .Values.advancedAuditSystem.resources | nindent 12 }}
        volumeMounts:
        - name: audit-config
          mountPath: /etc/audit
          readOnly: true
        - name: blockchain-config
          mountPath: /etc/blockchain
          readOnly: true
        - name: ai-models
          mountPath: /var/lib/ai-models
        - name: audit-data
          mountPath: /var/lib/audit
        - name: forensic-data
          mountPath: /var/lib/forensic
        - name: analytics-data
          mountPath: /var/lib/analytics
        - name: threat-intelligence
          mountPath: /var/lib/threat-intelligence
        - name: audit-logs
          mountPath: /var/log/audit
      volumes:
      - name: audit-config
        configMap:
          name: {{ include "csr-controller.fullname" . }}-advanced-audit-config
      - name: blockchain-config
        secret:
          secretName: {{ .Values.advancedAuditSystem.blockchainAudit.secretName | default (printf "%s-blockchain-config" (include "csr-controller.fullname" .)) }}
      - name: ai-models
        persistentVolumeClaim:
          claimName: {{ include "csr-controller.fullname" . }}-ai-models
      - name: audit-data
        persistentVolumeClaim:
          claimName: {{ include "csr-controller.fullname" . }}-audit-data
      - name: forensic-data
        persistentVolumeClaim:
          claimName: {{ include "csr-controller.fullname" . }}-forensic-data
      - name: analytics-data
        persistentVolumeClaim:
          claimName: {{ include "csr-controller.fullname" . }}-analytics-data
      - name: threat-intelligence
        persistentVolumeClaim:
          claimName: {{ include "csr-controller.fullname" . }}-threat-intelligence
      - name: audit-logs
        persistentVolumeClaim:
          claimName: {{ include "csr-controller.fullname" . }}-advanced-audit-logs
      {{- with .Values.nodeSelector }}
      nodeSelector:
        {{- toYaml . | nindent 8 }}
      {{- end }}
      {{- with .Values.affinity }}
      affinity:
        {{- toYaml . | nindent 8 }}
      {{- end }}
      {{- with .Values.tolerations }}
      tolerations:
        {{- toYaml . | nindent 8 }}
      {{- end }}
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "csr-controller.fullname" . }}-advanced-audit-config
  namespace: {{ .Release.Namespace }}
  labels:
    {{- include "csr-controller.labels" . | nindent 4 }}
    app.kubernetes.io/component: advanced-audit-system
data:
  advanced-audit-config.yaml: |
    # Advanced Audit System Configuration
    version: "1.0"
    
    # Global Configuration
    global:
      organization: {{ .Values.advancedAuditSystem.organization | default "Alt RSS Reader" | quote }}
      audit_level: {{ .Values.advancedAuditSystem.auditLevel | default "comprehensive" | quote }}
      real_time_processing: {{ .Values.advancedAuditSystem.realTimeProcessing | default true }}
      
    # Blockchain Audit Configuration
    blockchain_audit:
      enabled: {{ .Values.advancedAuditSystem.blockchainAudit.enabled | default true }}
      
      # Blockchain Network Configuration
      network:
        type: {{ .Values.advancedAuditSystem.blockchainAudit.network.type | default "ethereum" | quote }}
        network_id: {{ .Values.advancedAuditSystem.blockchainAudit.network.networkId | default "alt-audit-chain" | quote }}
        consensus: {{ .Values.advancedAuditSystem.blockchainAudit.network.consensus | default "proof_of_authority" | quote }}
        
      # Smart Contract Configuration
      smart_contracts:
        - name: "audit_trail_contract"
          address: {{ .Values.advancedAuditSystem.blockchainAudit.smartContracts.auditTrailContract.address | default "0x1234567890abcdef1234567890abcdef12345678" | quote }}
          abi_file: "/etc/blockchain/audit_trail_abi.json"
          
        - name: "integrity_verification_contract"
          address: {{ .Values.advancedAuditSystem.blockchainAudit.smartContracts.integrityVerificationContract.address | default "0xabcdef1234567890abcdef1234567890abcdef12" | quote }}
          abi_file: "/etc/blockchain/integrity_verification_abi.json"
          
        - name: "certificate_lifecycle_contract"
          address: {{ .Values.advancedAuditSystem.blockchainAudit.smartContracts.certificateLifecycleContract.address | default "0x567890abcdef1234567890abcdef1234567890ab" | quote }}
          abi_file: "/etc/blockchain/certificate_lifecycle_abi.json"
      
      # Immutable Log Configuration
      immutable_logs:
        enabled: {{ .Values.advancedAuditSystem.blockchainAudit.immutableLogs.enabled | default true }}
        
        # Log Categories
        categories:
          - "certificate_issuance"
          - "certificate_revocation"
          - "key_operations"
          - "policy_changes"
          - "security_events"
          - "compliance_violations"
          - "system_changes"
          - "user_actions"
        
        # Cryptographic Hashing
        hashing:
          algorithm: {{ .Values.advancedAuditSystem.blockchainAudit.immutableLogs.hashing.algorithm | default "SHA-256" | quote }}
          merkle_tree: {{ .Values.advancedAuditSystem.blockchainAudit.immutableLogs.hashing.merkleTree | default true }}
          
        # Batch Processing
        batching:
          enabled: {{ .Values.advancedAuditSystem.blockchainAudit.immutableLogs.batching.enabled | default true }}
          batch_size: {{ .Values.advancedAuditSystem.blockchainAudit.immutableLogs.batching.batchSize | default 100 }}
          batch_timeout: {{ .Values.advancedAuditSystem.blockchainAudit.immutableLogs.batching.batchTimeout | default "5m" | quote }}
      
      # Verification Configuration
      verification:
        enabled: {{ .Values.advancedAuditSystem.blockchainAudit.verification.enabled | default true }}
        verification_interval: {{ .Values.advancedAuditSystem.blockchainAudit.verification.verificationInterval | default "1h" | quote }}
        integrity_checks: {{ .Values.advancedAuditSystem.blockchainAudit.verification.integrityChecks | default true }}
        
        # Consensus Verification
        consensus_verification:
          enabled: {{ .Values.advancedAuditSystem.blockchainAudit.verification.consensusVerification.enabled | default true }}
          minimum_confirmations: {{ .Values.advancedAuditSystem.blockchainAudit.verification.consensusVerification.minimumConfirmations | default 6 }}
          
        # Third-Party Verification
        third_party_verification:
          enabled: {{ .Values.advancedAuditSystem.blockchainAudit.verification.thirdPartyVerification.enabled | default true }}
          verification_nodes:
            - {{ .Values.advancedAuditSystem.blockchainAudit.verification.thirdPartyVerification.verificationNodes | default "https://verify1.alt.production.local" | quote }}
            - {{ .Values.advancedAuditSystem.blockchainAudit.verification.thirdPartyVerification.verificationNodes | default "https://verify2.alt.production.local" | quote }}
    
    # AI Anomaly Detection Configuration
    ai_anomaly_detection:
      enabled: {{ .Values.advancedAuditSystem.aiAnomalyDetection.enabled | default true }}
      
      # Machine Learning Models
      models:
        - name: "isolation_forest"
          enabled: {{ .Values.advancedAuditSystem.aiAnomalyDetection.models.isolationForest.enabled | default true }}
          contamination: {{ .Values.advancedAuditSystem.aiAnomalyDetection.models.isolationForest.contamination | default 0.1 }}
          n_estimators: {{ .Values.advancedAuditSystem.aiAnomalyDetection.models.isolationForest.nEstimators | default 100 }}
          
        - name: "one_class_svm"
          enabled: {{ .Values.advancedAuditSystem.aiAnomalyDetection.models.oneClassSvm.enabled | default true }}
          kernel: {{ .Values.advancedAuditSystem.aiAnomalyDetection.models.oneClassSvm.kernel | default "rbf" | quote }}
          nu: {{ .Values.advancedAuditSystem.aiAnomalyDetection.models.oneClassSvm.nu | default 0.05 }}
          
        - name: "autoencoder"
          enabled: {{ .Values.advancedAuditSystem.aiAnomalyDetection.models.autoencoder.enabled | default true }}
          encoding_dim: {{ .Values.advancedAuditSystem.aiAnomalyDetection.models.autoencoder.encodingDim | default 32 }}
          threshold: {{ .Values.advancedAuditSystem.aiAnomalyDetection.models.autoencoder.threshold | default 0.95 }}
          
        - name: "lstm_autoencoder"
          enabled: {{ .Values.advancedAuditSystem.aiAnomalyDetection.models.lstmAutoencoder.enabled | default true }}
          sequence_length: {{ .Values.advancedAuditSystem.aiAnomalyDetection.models.lstmAutoencoder.sequenceLength | default 50 }}
          lstm_units: {{ .Values.advancedAuditSystem.aiAnomalyDetection.models.lstmAutoencoder.lstmUnits | default 64 }}
      
      # Feature Engineering
      feature_engineering:
        enabled: {{ .Values.advancedAuditSystem.aiAnomalyDetection.featureEngineering.enabled | default true }}
        
        # Feature Extraction
        features:
          - "event_frequency"
          - "event_timing"
          - "event_patterns"
          - "user_behavior"
          - "system_behavior"
          - "network_patterns"
          - "access_patterns"
          - "error_patterns"
          - "certificate_patterns"
          - "cryptographic_patterns"
        
        # Feature Preprocessing
        preprocessing:
          normalization: {{ .Values.advancedAuditSystem.aiAnomalyDetection.featureEngineering.preprocessing.normalization | default "min_max" | quote }}
          scaling: {{ .Values.advancedAuditSystem.aiAnomalyDetection.featureEngineering.preprocessing.scaling | default true }}
          dimensionality_reduction: {{ .Values.advancedAuditSystem.aiAnomalyDetection.featureEngineering.preprocessing.dimensionalityReduction | default "pca" | quote }}
          
        # Feature Selection
        selection:
          enabled: {{ .Values.advancedAuditSystem.aiAnomalyDetection.featureEngineering.selection.enabled | default true }}
          method: {{ .Values.advancedAuditSystem.aiAnomalyDetection.featureEngineering.selection.method | default "mutual_info" | quote }}
          k_best: {{ .Values.advancedAuditSystem.aiAnomalyDetection.featureEngineering.selection.kBest | default 20 }}
      
      # Training Configuration
      training:
        enabled: {{ .Values.advancedAuditSystem.aiAnomalyDetection.training.enabled | default true }}
        
        # Training Schedule
        schedule:
          initial_training: {{ .Values.advancedAuditSystem.aiAnomalyDetection.training.schedule.initialTraining | default "immediate" | quote }}
          retraining_interval: {{ .Values.advancedAuditSystem.aiAnomalyDetection.training.schedule.retrainingInterval | default "weekly" | quote }}
          incremental_learning: {{ .Values.advancedAuditSystem.aiAnomalyDetection.training.schedule.incrementalLearning | default true }}
          
        # Training Data
        training_data:
          lookback_period: {{ .Values.advancedAuditSystem.aiAnomalyDetection.training.trainingData.lookbackPeriod | default "30d" | quote }}
          minimum_samples: {{ .Values.advancedAuditSystem.aiAnomalyDetection.training.trainingData.minimumSamples | default 1000 }}
          validation_split: {{ .Values.advancedAuditSystem.aiAnomalyDetection.training.trainingData.validationSplit | default 0.2 }}
          
        # Model Evaluation
        evaluation:
          metrics:
            - "precision"
            - "recall"
            - "f1_score"
            - "auc_roc"
            - "false_positive_rate"
            - "false_negative_rate"
          performance_threshold: {{ .Values.advancedAuditSystem.aiAnomalyDetection.training.evaluation.performanceThreshold | default 0.85 }}
          
        # Model Versioning
        versioning:
          enabled: {{ .Values.advancedAuditSystem.aiAnomalyDetection.training.versioning.enabled | default true }}
          max_versions: {{ .Values.advancedAuditSystem.aiAnomalyDetection.training.versioning.maxVersions | default 10 }}
          auto_deployment: {{ .Values.advancedAuditSystem.aiAnomalyDetection.training.versioning.autoDeployment | default true }}
      
      # Real-time Detection
      real_time_detection:
        enabled: {{ .Values.advancedAuditSystem.aiAnomalyDetection.realTimeDetection.enabled | default true }}
        
        # Detection Thresholds
        thresholds:
          low_confidence: {{ .Values.advancedAuditSystem.aiAnomalyDetection.realTimeDetection.thresholds.lowConfidence | default 0.3 }}
          medium_confidence: {{ .Values.advancedAuditSystem.aiAnomalyDetection.realTimeDetection.thresholds.mediumConfidence | default 0.6 }}
          high_confidence: {{ .Values.advancedAuditSystem.aiAnomalyDetection.realTimeDetection.thresholds.highConfidence | default 0.85 }}
          
        # Response Actions
        response_actions:
          - threshold: "high_confidence"
            actions:
              - "create_incident"
              - "block_activity"
              - "notify_security_team"
              - "collect_forensic_data"
              
          - threshold: "medium_confidence"
            actions:
              - "create_alert"
              - "increase_monitoring"
              - "notify_analysts"
              
          - threshold: "low_confidence"
            actions:
              - "log_event"
              - "update_baseline"
    
    # Real-time Analysis Configuration
    real_time_analysis:
      enabled: {{ .Values.advancedAuditSystem.realTimeAnalysis.enabled | default true }}
      
      # Stream Processing
      stream_processing:
        enabled: {{ .Values.advancedAuditSystem.realTimeAnalysis.streamProcessing.enabled | default true }}
        
        # Event Streaming
        event_streaming:
          platform: {{ .Values.advancedAuditSystem.realTimeAnalysis.streamProcessing.eventStreaming.platform | default "kafka" | quote }}
          topics:
            - "audit-events"
            - "security-events"
            - "certificate-events"
            - "system-events"
            - "user-events"
          
          # Kafka Configuration
          kafka:
            brokers: {{ .Values.advancedAuditSystem.realTimeAnalysis.streamProcessing.eventStreaming.kafka.brokers | default "kafka:9092" | quote }}
            consumer_group: {{ .Values.advancedAuditSystem.realTimeAnalysis.streamProcessing.eventStreaming.kafka.consumerGroup | default "audit-analyzer" | quote }}
            
        # Complex Event Processing
        complex_event_processing:
          enabled: {{ .Values.advancedAuditSystem.realTimeAnalysis.streamProcessing.complexEventProcessing.enabled | default true }}
          
          # Event Patterns
          patterns:
            - name: "suspicious_login_pattern"
              description: "Multiple failed logins followed by successful login"
              pattern: "FAILED_LOGIN{3,} -> SUCCESSFUL_LOGIN"
              window: "5m"
              
            - name: "privilege_escalation_pattern"
              description: "Rapid privilege changes"
              pattern: "PRIVILEGE_CHANGE{2,}"
              window: "1m"
              
            - name: "bulk_certificate_request"
              description: "Unusual number of certificate requests"
              pattern: "CERTIFICATE_REQUEST{10,}"
              window: "1h"
              
            - name: "off_hours_activity"
              description: "Administrative activity during off hours"
              pattern: "ADMIN_ACTION"
              conditions:
                - "time_of_day < 06:00 OR time_of_day > 22:00"
                - "day_of_week = 'Saturday' OR day_of_week = 'Sunday'"
      
      # Correlation Engine
      correlation_engine:
        enabled: {{ .Values.advancedAuditSystem.realTimeAnalysis.correlationEngine.enabled | default true }}
        
        # Correlation Rules
        rules:
          - name: "certificate_abuse_detection"
            description: "Detect certificate abuse patterns"
            conditions:
              - "certificate_requests > 5 per hour"
              - "certificate_failures > 50%"
              - "unusual_dns_patterns"
            severity: "high"
            
          - name: "insider_threat_detection"
            description: "Detect potential insider threats"
            conditions:
              - "after_hours_access"
              - "unusual_data_access"
              - "policy_violations"
            severity: "critical"
            
          - name: "system_compromise_detection"
            description: "Detect system compromise indicators"
            conditions:
              - "unexpected_system_changes"
              - "unusual_network_traffic"
              - "privilege_escalation"
            severity: "critical"
        
        # Correlation Algorithms
        algorithms:
          - name: "time_based_correlation"
            enabled: {{ .Values.advancedAuditSystem.realTimeAnalysis.correlationEngine.algorithms.timeBasedCorrelation.enabled | default true }}
            window: {{ .Values.advancedAuditSystem.realTimeAnalysis.correlationEngine.algorithms.timeBasedCorrelation.window | default "1h" | quote }}
            
          - name: "entity_based_correlation"
            enabled: {{ .Values.advancedAuditSystem.realTimeAnalysis.correlationEngine.algorithms.entityBasedCorrelation.enabled | default true }}
            entities:
              - "users"
              - "systems"
              - "certificates"
              - "ip_addresses"
              
          - name: "pattern_based_correlation"
            enabled: {{ .Values.advancedAuditSystem.realTimeAnalysis.correlationEngine.algorithms.patternBasedCorrelation.enabled | default true }}
            similarity_threshold: {{ .Values.advancedAuditSystem.realTimeAnalysis.correlationEngine.algorithms.patternBasedCorrelation.similarityThreshold | default 0.8 }}
    
    # Forensic Analysis Configuration
    forensic_analysis:
      enabled: {{ .Values.advancedAuditSystem.forensicAnalysis.enabled | default true }}
      
      # Digital Forensics
      digital_forensics:
        enabled: {{ .Values.advancedAuditSystem.forensicAnalysis.digitalForensics.enabled | default true }}
        
        # Evidence Collection
        evidence_collection:
          automatic_collection: {{ .Values.advancedAuditSystem.forensicAnalysis.digitalForensics.evidenceCollection.automaticCollection | default true }}
          
          # Collection Triggers
          triggers:
            - "security_incident"
            - "compliance_violation"
            - "anomaly_detection"
            - "manual_request"
            
          # Collection Types
          types:
            - "system_snapshots"
            - "memory_dumps"
            - "network_traces"
            - "log_files"
            - "configuration_files"
            - "database_records"
            - "certificate_stores"
            
        # Chain of Custody
        chain_of_custody:
          enabled: {{ .Values.advancedAuditSystem.forensicAnalysis.digitalForensics.chainOfCustody.enabled | default true }}
          
          # Custody Tracking
          tracking:
            blockchain_based: {{ .Values.advancedAuditSystem.forensicAnalysis.digitalForensics.chainOfCustody.tracking.blockchainBased | default true }}
            digital_signatures: {{ .Values.advancedAuditSystem.forensicAnalysis.digitalForensics.chainOfCustody.tracking.digitalSignatures | default true }}
            timestamp_server: {{ .Values.advancedAuditSystem.forensicAnalysis.digitalForensics.chainOfCustody.tracking.timestampServer | default true }}
            
          # Custody Procedures
          procedures:
            evidence_labeling: {{ .Values.advancedAuditSystem.forensicAnalysis.digitalForensics.chainOfCustody.procedures.evidenceLabeling | default true }}
            access_logging: {{ .Values.advancedAuditSystem.forensicAnalysis.digitalForensics.chainOfCustody.procedures.accessLogging | default true }}
            integrity_verification: {{ .Values.advancedAuditSystem.forensicAnalysis.digitalForensics.chainOfCustody.procedures.integrityVerification | default true }}
        
        # Forensic Analysis Tools
        analysis_tools:
          - name: "autopsy"
            enabled: {{ .Values.advancedAuditSystem.forensicAnalysis.digitalForensics.analysisTools.autopsy.enabled | default true }}
            
          - name: "volatility"
            enabled: {{ .Values.advancedAuditSystem.forensicAnalysis.digitalForensics.analysisTools.volatility.enabled | default true }}
            
          - name: "sleuth_kit"
            enabled: {{ .Values.advancedAuditSystem.forensicAnalysis.digitalForensics.analysisTools.sleuthKit.enabled | default true }}
            
          - name: "wireshark"
            enabled: {{ .Values.advancedAuditSystem.forensicAnalysis.digitalForensics.analysisTools.wireshark.enabled | default true }}
      
      # Timeline Analysis
      timeline_analysis:
        enabled: {{ .Values.advancedAuditSystem.forensicAnalysis.timelineAnalysis.enabled | default true }}
        
        # Timeline Construction
        construction:
          automatic_timeline: {{ .Values.advancedAuditSystem.forensicAnalysis.timelineAnalysis.construction.automaticTimeline | default true }}
          
          # Data Sources
          data_sources:
            - "audit_logs"
            - "system_logs"
            - "application_logs"
            - "network_logs"
            - "database_logs"
            - "file_system_events"
            - "registry_changes"
            
          # Timeline Granularity
          granularity:
            minimum_interval: {{ .Values.advancedAuditSystem.forensicAnalysis.timelineAnalysis.construction.granularity.minimumInterval | default "1s" | quote }}
            maximum_span: {{ .Values.advancedAuditSystem.forensicAnalysis.timelineAnalysis.construction.granularity.maximumSpan | default "1y" | quote }}
            
        # Timeline Visualization
        visualization:
          enabled: {{ .Values.advancedAuditSystem.forensicAnalysis.timelineAnalysis.visualization.enabled | default true }}
          
          # Visualization Features
          features:
            - "interactive_timeline"
            - "event_filtering"
            - "zoom_capabilities"
            - "correlation_highlighting"
            - "anomaly_marking"
            - "pattern_detection"
    
    # Predictive Analytics Configuration
    predictive_analytics:
      enabled: {{ .Values.advancedAuditSystem.predictiveAnalytics.enabled | default true }}
      
      # Predictive Models
      models:
        - name: "security_incident_prediction"
          enabled: {{ .Values.advancedAuditSystem.predictiveAnalytics.models.securityIncidentPrediction.enabled | default true }}
          algorithm: {{ .Values.advancedAuditSystem.predictiveAnalytics.models.securityIncidentPrediction.algorithm | default "random_forest" | quote }}
          prediction_horizon: {{ .Values.advancedAuditSystem.predictiveAnalytics.models.securityIncidentPrediction.predictionHorizon | default "7d" | quote }}
          
        - name: "compliance_violation_prediction"
          enabled: {{ .Values.advancedAuditSystem.predictiveAnalytics.models.complianceViolationPrediction.enabled | default true }}
          algorithm: {{ .Values.advancedAuditSystem.predictiveAnalytics.models.complianceViolationPrediction.algorithm | default "gradient_boosting" | quote }}
          prediction_horizon: {{ .Values.advancedAuditSystem.predictiveAnalytics.models.complianceViolationPrediction.predictionHorizon | default "30d" | quote }}
          
        - name: "certificate_abuse_prediction"
          enabled: {{ .Values.advancedAuditSystem.predictiveAnalytics.models.certificateAbusePrediction.enabled | default true }}
          algorithm: {{ .Values.advancedAuditSystem.predictiveAnalytics.models.certificateAbusePrediction.algorithm | default "neural_network" | quote }}
          prediction_horizon: {{ .Values.advancedAuditSystem.predictiveAnalytics.models.certificateAbusePrediction.predictionHorizon | default "14d" | quote }}
          
        - name: "system_failure_prediction"
          enabled: {{ .Values.advancedAuditSystem.predictiveAnalytics.models.systemFailurePrediction.enabled | default true }}
          algorithm: {{ .Values.advancedAuditSystem.predictiveAnalytics.models.systemFailurePrediction.algorithm | default "lstm" | quote }}
          prediction_horizon: {{ .Values.advancedAuditSystem.predictiveAnalytics.models.systemFailurePrediction.predictionHorizon | default "3d" | quote }}
      
      # Risk Scoring
      risk_scoring:
        enabled: {{ .Values.advancedAuditSystem.predictiveAnalytics.riskScoring.enabled | default true }}
        
        # Risk Factors
        factors:
          - name: "historical_patterns"
            weight: {{ .Values.advancedAuditSystem.predictiveAnalytics.riskScoring.factors.historicalPatterns.weight | default 0.3 }}
            
          - name: "current_behavior"
            weight: {{ .Values.advancedAuditSystem.predictiveAnalytics.riskScoring.factors.currentBehavior.weight | default 0.25 }}
            
          - name: "environmental_factors"
            weight: {{ .Values.advancedAuditSystem.predictiveAnalytics.riskScoring.factors.environmentalFactors.weight | default 0.2 }}
            
          - name: "threat_intelligence"
            weight: {{ .Values.advancedAuditSystem.predictiveAnalytics.riskScoring.factors.threatIntelligence.weight | default 0.15 }}
            
          - name: "system_vulnerabilities"
            weight: {{ .Values.advancedAuditSystem.predictiveAnalytics.riskScoring.factors.systemVulnerabilities.weight | default 0.1 }}
        
        # Risk Thresholds
        thresholds:
          low: {{ .Values.advancedAuditSystem.predictiveAnalytics.riskScoring.thresholds.low | default 0.3 }}
          medium: {{ .Values.advancedAuditSystem.predictiveAnalytics.riskScoring.thresholds.medium | default 0.6 }}
          high: {{ .Values.advancedAuditSystem.predictiveAnalytics.riskScoring.thresholds.high | default 0.8 }}
          critical: {{ .Values.advancedAuditSystem.predictiveAnalytics.riskScoring.thresholds.critical | default 0.95 }}
      
      # Proactive Measures
      proactive_measures:
        enabled: {{ .Values.advancedAuditSystem.predictiveAnalytics.proactiveMeasures.enabled | default true }}
        
        # Automated Actions
        automated_actions:
          - trigger: "high_risk_prediction"
            actions:
              - "increase_monitoring"
              - "apply_preventive_controls"
              - "notify_security_team"
              - "create_investigation_ticket"
              
          - trigger: "critical_risk_prediction"
            actions:
              - "emergency_response"
              - "isolate_affected_systems"
              - "notify_incident_response_team"
              - "create_emergency_ticket"
        
        # Preventive Controls
        preventive_controls:
          - name: "access_restriction"
            description: "Restrict access to high-risk resources"
            
          - name: "monitoring_enhancement"
            description: "Increase monitoring granularity"
            
          - name: "security_hardening"
            description: "Apply additional security controls"
            
          - name: "backup_acceleration"
            description: "Accelerate backup schedules"
    
    # Threat Hunting Configuration
    threat_hunting:
      enabled: {{ .Values.advancedAuditSystem.threatHunting.enabled | default true }}
      
      # Hunting Methodologies
      methodologies:
        - name: "hypothesis_driven"
          enabled: {{ .Values.advancedAuditSystem.threatHunting.methodologies.hypothesisDriven.enabled | default true }}
          
        - name: "model_driven"
          enabled: {{ .Values.advancedAuditSystem.threatHunting.methodologies.modelDriven.enabled | default true }}
          
        - name: "intelligence_driven"
          enabled: {{ .Values.advancedAuditSystem.threatHunting.methodologies.intelligenceDriven.enabled | default true }}
          
        - name: "situational_awareness"
          enabled: {{ .Values.advancedAuditSystem.threatHunting.methodologies.situationalAwareness.enabled | default true }}
      
      # Hunting Techniques
      techniques:
        - name: "behavioral_analysis"
          enabled: {{ .Values.advancedAuditSystem.threatHunting.techniques.behavioralAnalysis.enabled | default true }}
          
        - name: "statistical_analysis"
          enabled: {{ .Values.advancedAuditSystem.threatHunting.techniques.statisticalAnalysis.enabled | default true }}
          
        - name: "machine_learning"
          enabled: {{ .Values.advancedAuditSystem.threatHunting.techniques.machineLearning.enabled | default true }}
          
        - name: "threat_intelligence_correlation"
          enabled: {{ .Values.advancedAuditSystem.threatHunting.techniques.threatIntelligenceCorrelation.enabled | default true }}
      
      # Hunting Queries
      queries:
        - name: "certificate_anomalies"
          description: "Hunt for certificate-related anomalies"
          query: |
            SELECT * FROM audit_events 
            WHERE event_type = 'certificate_request' 
            AND (
              dns_names LIKE '%.onion' 
              OR dns_names LIKE '%.bit' 
              OR subject_name LIKE '%admin%'
              OR subject_name LIKE '%root%'
            )
            AND timestamp > NOW() - INTERVAL '7 days'
          
        - name: "privilege_escalation_hunting"
          description: "Hunt for privilege escalation attempts"
          query: |
            SELECT user_id, COUNT(*) as escalation_count 
            FROM audit_events 
            WHERE event_type = 'privilege_change' 
            AND new_privileges > old_privileges 
            AND timestamp > NOW() - INTERVAL '24 hours'
            GROUP BY user_id 
            HAVING escalation_count > 3
          
        - name: "off_hours_activity"
          description: "Hunt for suspicious off-hours activity"
          query: |
            SELECT * FROM audit_events 
            WHERE (
              EXTRACT(hour FROM timestamp) < 6 
              OR EXTRACT(hour FROM timestamp) > 22
              OR EXTRACT(dow FROM timestamp) IN (0, 6)
            )
            AND event_severity = 'high'
            AND timestamp > NOW() - INTERVAL '7 days'
      
      # Automated Hunting
      automated_hunting:
        enabled: {{ .Values.advancedAuditSystem.threatHunting.automatedHunting.enabled | default true }}
        
        # Hunting Schedule
        schedule:
          daily_hunts: {{ .Values.advancedAuditSystem.threatHunting.automatedHunting.schedule.dailyHunts | default "0 3 * * *" | quote }}
          weekly_hunts: {{ .Values.advancedAuditSystem.threatHunting.automatedHunting.schedule.weeklyHunts | default "0 3 * * 0" | quote }}
          monthly_hunts: {{ .Values.advancedAuditSystem.threatHunting.automatedHunting.schedule.monthlyHunts | default "0 3 1 * *" | quote }}
        
        # Hunt Results Processing
        results_processing:
          auto_triage: {{ .Values.advancedAuditSystem.threatHunting.automatedHunting.resultsProcessing.autoTriage | default true }}
          false_positive_learning: {{ .Values.advancedAuditSystem.threatHunting.automatedHunting.resultsProcessing.falsePositiveLearning | default true }}
          threat_attribution: {{ .Values.advancedAuditSystem.threatHunting.automatedHunting.resultsProcessing.threatAttribution | default true }}
    
    # Advanced Reporting Configuration
    advanced_reporting:
      enabled: {{ .Values.advancedAuditSystem.advancedReporting.enabled | default true }}
      
      # Report Types
      types:
        - name: "executive_security_dashboard"
          enabled: {{ .Values.advancedAuditSystem.advancedReporting.types.executiveSecurityDashboard.enabled | default true }}
          frequency: {{ .Values.advancedAuditSystem.advancedReporting.types.executiveSecurityDashboard.frequency | default "weekly" | quote }}
          
        - name: "forensic_investigation_report"
          enabled: {{ .Values.advancedAuditSystem.advancedReporting.types.forensicInvestigationReport.enabled | default true }}
          frequency: {{ .Values.advancedAuditSystem.advancedReporting.types.forensicInvestigationReport.frequency | default "on_demand" | quote }}
          
        - name: "threat_hunting_report"
          enabled: {{ .Values.advancedAuditSystem.advancedReporting.types.threatHuntingReport.enabled | default true }}
          frequency: {{ .Values.advancedAuditSystem.advancedReporting.types.threatHuntingReport.frequency | default "monthly" | quote }}
          
        - name: "predictive_analytics_report"
          enabled: {{ .Values.advancedAuditSystem.advancedReporting.types.predictiveAnalyticsReport.enabled | default true }}
          frequency: {{ .Values.advancedAuditSystem.advancedReporting.types.predictiveAnalyticsReport.frequency | default "quarterly" | quote }}
      
      # Interactive Dashboards
      dashboards:
        enabled: {{ .Values.advancedAuditSystem.advancedReporting.dashboards.enabled | default true }}
        
        # Dashboard Features
        features:
          - "real_time_monitoring"
          - "drill_down_capabilities"
          - "custom_visualizations"
          - "alert_integration"
          - "collaboration_tools"
          - "export_capabilities"
        
        # Dashboard Access Control
        access_control:
          role_based_access: {{ .Values.advancedAuditSystem.advancedReporting.dashboards.accessControl.roleBasedAccess | default true }}
          
          # Dashboard Roles
          roles:
            - name: "security_analyst"
              dashboards:
                - "threat_hunting_dashboard"
                - "incident_response_dashboard"
                - "forensic_analysis_dashboard"
                
            - name: "compliance_officer"
              dashboards:
                - "compliance_dashboard"
                - "audit_dashboard"
                - "risk_management_dashboard"
                
            - name: "executive"
              dashboards:
                - "executive_dashboard"
                - "risk_overview_dashboard"
                - "business_impact_dashboard"
      
      # Custom Analytics
      custom_analytics:
        enabled: {{ .Values.advancedAuditSystem.advancedReporting.customAnalytics.enabled | default true }}
        
        # Analytics Engine
        engine:
          type: {{ .Values.advancedAuditSystem.advancedReporting.customAnalytics.engine.type | default "spark" | quote }}
          
          # Spark Configuration
          spark:
            master: {{ .Values.advancedAuditSystem.advancedReporting.customAnalytics.engine.spark.master | default "local[*]" | quote }}
            executor_memory: {{ .Values.advancedAuditSystem.advancedReporting.customAnalytics.engine.spark.executorMemory | default "4g" | quote }}
            driver_memory: {{ .Values.advancedAuditSystem.advancedReporting.customAnalytics.engine.spark.driverMemory | default "2g" | quote }}
        
        # Custom Queries
        queries:
          enabled: {{ .Values.advancedAuditSystem.advancedReporting.customAnalytics.queries.enabled | default true }}
          
          # Query Templates
          templates:
            - name: "security_trend_analysis"
              description: "Analyze security trends over time"
              
            - name: "user_behavior_analysis"
              description: "Analyze user behavior patterns"
              
            - name: "certificate_usage_analysis"
              description: "Analyze certificate usage patterns"
              
            - name: "compliance_gap_analysis"
              description: "Analyze compliance gaps"
    
    # Integration Configuration
    integration:
      # SIEM Integration
      siem:
        enabled: {{ .Values.advancedAuditSystem.integration.siem.enabled | default true }}
        
        # Supported SIEM Platforms
        platforms:
          - name: "splunk"
            enabled: {{ .Values.advancedAuditSystem.integration.siem.platforms.splunk.enabled | default true }}
            endpoint: {{ .Values.advancedAuditSystem.integration.siem.platforms.splunk.endpoint | default "https://splunk.alt.production.local:8089" | quote }}
            
          - name: "elasticsearch"
            enabled: {{ .Values.advancedAuditSystem.integration.siem.platforms.elasticsearch.enabled | default true }}
            endpoint: {{ .Values.advancedAuditSystem.integration.siem.platforms.elasticsearch.endpoint | default "https://elasticsearch.alt.production.local:9200" | quote }}
            
          - name: "qradar"
            enabled: {{ .Values.advancedAuditSystem.integration.siem.platforms.qradar.enabled | default false }}
            endpoint: {{ .Values.advancedAuditSystem.integration.siem.platforms.qradar.endpoint | default "" | quote }}
            
          - name: "arcsight"
            enabled: {{ .Values.advancedAuditSystem.integration.siem.platforms.arcsight.enabled | default false }}
            endpoint: {{ .Values.advancedAuditSystem.integration.siem.platforms.arcsight.endpoint | default "" | quote }}
      
      # Threat Intelligence Integration
      threat_intelligence:
        enabled: {{ .Values.advancedAuditSystem.integration.threatIntelligence.enabled | default true }}
        
        # Threat Intelligence Feeds
        feeds:
          - name: "misp"
            enabled: {{ .Values.advancedAuditSystem.integration.threatIntelligence.feeds.misp.enabled | default true }}
            endpoint: {{ .Values.advancedAuditSystem.integration.threatIntelligence.feeds.misp.endpoint | default "https://misp.alt.production.local" | quote }}
            
          - name: "opencti"
            enabled: {{ .Values.advancedAuditSystem.integration.threatIntelligence.feeds.opencti.enabled | default true }}
            endpoint: {{ .Values.advancedAuditSystem.integration.threatIntelligence.feeds.opencti.endpoint | default "https://opencti.alt.production.local" | quote }}
            
          - name: "commercial_feeds"
            enabled: {{ .Values.advancedAuditSystem.integration.threatIntelligence.feeds.commercialFeeds.enabled | default false }}
            providers:
              - "recorded_future"
              - "crowdstrike"
              - "fireeye"
      
      # External Forensic Tools
      forensic_tools:
        enabled: {{ .Values.advancedAuditSystem.integration.forensicTools.enabled | default true }}
        
        # Tool Integrations
        tools:
          - name: "encase"
            enabled: {{ .Values.advancedAuditSystem.integration.forensicTools.tools.encase.enabled | default false }}
            
          - name: "ftk"
            enabled: {{ .Values.advancedAuditSystem.integration.forensicTools.tools.ftk.enabled | default false }}
            
          - name: "x_ways"
            enabled: {{ .Values.advancedAuditSystem.integration.forensicTools.tools.xWays.enabled | default false }}
            
          - name: "open_source_tools"
            enabled: {{ .Values.advancedAuditSystem.integration.forensicTools.tools.openSourceTools.enabled | default true }}
            tools:
              - "autopsy"
              - "sleuth_kit"
              - "volatility"
              - "plaso"