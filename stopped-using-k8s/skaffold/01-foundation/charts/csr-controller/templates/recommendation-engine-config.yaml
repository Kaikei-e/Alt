apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "csr-controller.fullname" . }}-recommendation-engine-config
  namespace: {{ .Release.Namespace }}
  labels:
    {{- include "csr-controller.labels" . | nindent 4 }}
    app.kubernetes.io/component: security-recommendation-engine
data:
  recommendation-engine.yaml: |
    # Security Recommendation Engine Configuration
    version: "1.0"
    
    # Global Configuration
    global:
      organization: {{ .Values.securityRecommendationEngine.organization | default "Alt RSS Reader" | quote }}
      environment: {{ .Values.securityRecommendationEngine.environment | default "production" | quote }}
      recommendation_scope: {{ .Values.securityRecommendationEngine.recommendationScope | default "comprehensive" | quote }}
      
    # Vulnerability Recommendations Configuration
    vulnerability_recommendations:
      enabled: {{ .Values.securityRecommendationEngine.vulnerabilityRecommendations.enabled | default true }}
      
      # Vulnerability Sources
      sources:
        - name: "cve_databases"
          enabled: {{ .Values.securityRecommendationEngine.vulnerabilityRecommendations.sources.cveDatabases.enabled | default true }}
          sources:
            - "nist_nvd"
            - "mitre_cve"
            - "cisa_kev"
            - "exploit_db"
          update_frequency: {{ .Values.securityRecommendationEngine.vulnerabilityRecommendations.sources.cveDatabases.updateFrequency | default "daily" | quote }}
          
        - name: "vulnerability_scanners"
          enabled: {{ .Values.securityRecommendationEngine.vulnerabilityRecommendations.sources.vulnerabilityScanners.enabled | default true }}
          scanners:
            - "trivy"
            - "clair"
            - "anchore"
            - "qualys"
            - "nessus"
          scan_frequency: {{ .Values.securityRecommendationEngine.vulnerabilityRecommendations.sources.vulnerabilityScanners.scanFrequency | default "weekly" | quote }}
          
        - name: "threat_intelligence"
          enabled: {{ .Values.securityRecommendationEngine.vulnerabilityRecommendations.sources.threatIntelligence.enabled | default true }}
          sources:
            - "commercial_feeds"
            - "open_source_feeds"
            - "internal_intelligence"
          update_frequency: {{ .Values.securityRecommendationEngine.vulnerabilityRecommendations.sources.threatIntelligence.updateFrequency | default "hourly" | quote }}
      
      # Vulnerability Analysis
      analysis:
        # Risk Assessment
        risk_assessment:
          enabled: {{ .Values.securityRecommendationEngine.vulnerabilityRecommendations.analysis.riskAssessment.enabled | default true }}
          
          # Risk Factors
          risk_factors:
            - name: "cvss_score"
              weight: {{ .Values.securityRecommendationEngine.vulnerabilityRecommendations.analysis.riskAssessment.riskFactors.cvssScore.weight | default 0.3 }}
              
            - name: "exploitability"
              weight: {{ .Values.securityRecommendationEngine.vulnerabilityRecommendations.analysis.riskAssessment.riskFactors.exploitability.weight | default 0.25 }}
              
            - name: "asset_criticality"
              weight: {{ .Values.securityRecommendationEngine.vulnerabilityRecommendations.analysis.riskAssessment.riskFactors.assetCriticality.weight | default 0.2 }}
              
            - name: "threat_context"
              weight: {{ .Values.securityRecommendationEngine.vulnerabilityRecommendations.analysis.riskAssessment.riskFactors.threatContext.weight | default 0.15 }}
              
            - name: "business_impact"
              weight: {{ .Values.securityRecommendationEngine.vulnerabilityRecommendations.analysis.riskAssessment.riskFactors.businessImpact.weight | default 0.1 }}
          
          # Risk Scoring
          risk_scoring:
            method: {{ .Values.securityRecommendationEngine.vulnerabilityRecommendations.analysis.riskAssessment.riskScoring.method | default "weighted_average" | quote }}
            normalization: {{ .Values.securityRecommendationEngine.vulnerabilityRecommendations.analysis.riskAssessment.riskScoring.normalization | default true }}
            
        # Remediation Analysis
        remediation_analysis:
          enabled: {{ .Values.securityRecommendationEngine.vulnerabilityRecommendations.analysis.remediationAnalysis.enabled | default true }}
          
          # Remediation Options
          options:
            - name: "patching"
              priority: {{ .Values.securityRecommendationEngine.vulnerabilityRecommendations.analysis.remediationAnalysis.options.patching.priority | default 1 }}
              feasibility_factors:
                - "patch_availability"
                - "system_downtime"
                - "compatibility_issues"
                - "testing_requirements"
              
            - name: "configuration_changes"
              priority: {{ .Values.securityRecommendationEngine.vulnerabilityRecommendations.analysis.remediationAnalysis.options.configurationChanges.priority | default 2 }}
              feasibility_factors:
                - "configuration_complexity"
                - "service_impact"
                - "rollback_capability"
                - "validation_requirements"
              
            - name: "compensating_controls"
              priority: {{ .Values.securityRecommendationEngine.vulnerabilityRecommendations.analysis.remediationAnalysis.options.compensatingControls.priority | default 3 }}
              feasibility_factors:
                - "control_effectiveness"
                - "implementation_cost"
                - "maintenance_overhead"
                - "detection_capability"
              
            - name: "system_isolation"
              priority: {{ .Values.securityRecommendationEngine.vulnerabilityRecommendations.analysis.remediationAnalysis.options.systemIsolation.priority | default 4 }}
              feasibility_factors:
                - "business_continuity"
                - "service_dependencies"
                - "user_impact"
                - "alternative_solutions"
      
      # Recommendation Generation
      generation:
        # Recommendation Types
        types:
          - name: "immediate_action"
            description: "Recommendations requiring immediate action"
            criteria:
              - "cvss_score >= 9.0"
              - "active_exploitation == true"
              - "critical_systems_affected == true"
            priority: {{ .Values.securityRecommendationEngine.vulnerabilityRecommendations.generation.types.immediateAction.priority | default "critical" | quote }}
            
          - name: "high_priority"
            description: "High priority recommendations"
            criteria:
              - "cvss_score >= 7.0"
              - "exploit_available == true"
              - "sensitive_data_exposure == true"
            priority: {{ .Values.securityRecommendationEngine.vulnerabilityRecommendations.generation.types.highPriority.priority | default "high" | quote }}
            
          - name: "medium_priority"
            description: "Medium priority recommendations"
            criteria:
              - "cvss_score >= 4.0"
              - "potential_impact == 'medium'"
              - "mitigation_available == true"
            priority: {{ .Values.securityRecommendationEngine.vulnerabilityRecommendations.generation.types.mediumPriority.priority | default "medium" | quote }}
            
          - name: "low_priority"
            description: "Low priority recommendations"
            criteria:
              - "cvss_score < 4.0"
              - "limited_impact == true"
              - "workaround_available == true"
            priority: {{ .Values.securityRecommendationEngine.vulnerabilityRecommendations.generation.types.lowPriority.priority | default "low" | quote }}
        
        # Recommendation Templates
        templates:
          - name: "critical_vulnerability_patch"
            template: |
              Critical Vulnerability Detected: {{"{{"}} vulnerability.cve_id {{"}}"}}
              
              **Severity:** {{"{{"}} vulnerability.cvss_score {{"}}"}} ({{"{{"}} vulnerability.severity {{"}}"}}))
              **Affected Systems:** {{"{{"}} vulnerability.affected_systems | join(', ') {{"}}"}}
              **Exploitation Risk:** {{"{{"}} vulnerability.exploitation_risk {{"}}"}}
              
              **Immediate Actions Required:**
              1. Apply security patch: {{"{{"}} vulnerability.patch_info.patch_id {{"}}"}}
              2. Verify patch installation
              3. Restart affected services
              4. Validate system functionality
              
              **Patch Details:**
              - Patch Version: {{"{{"}} vulnerability.patch_info.version {{"}}"}}
              - Release Date: {{"{{"}} vulnerability.patch_info.release_date {{"}}"}}
              - Downtime Required: {{"{{"}} vulnerability.patch_info.downtime_estimate {{"}}"}}
              
              **Business Impact:**
              - Risk Level: {{"{{"}} vulnerability.business_impact.risk_level {{"}}"}}
              - Affected Services: {{"{{"}} vulnerability.business_impact.affected_services | join(', ') {{"}}"}}
              - Estimated Downtime: {{"{{"}} vulnerability.business_impact.downtime_estimate {{"}}"}}
              
              **Timeline:**
              - Immediate: Apply patch within 24 hours
              - Verification: Complete within 48 hours
              - Monitoring: Enhanced monitoring for 7 days
              
              **Rollback Plan:**
              1. Create system backup before patching
              2. Document current configuration
              3. Prepare rollback procedures
              4. Test rollback in staging environment
            
          - name: "configuration_hardening"
            template: |
              Configuration Hardening Recommendation
              
              **Target System:** {{"{{"}} system.name {{"}}"}}
              **Current Risk Level:** {{"{{"}} system.risk_level {{"}}"}}
              **Recommended Actions:** {{"{{"}} recommendations.count {{"}}"}} configuration changes
              
              **High Priority Changes:**
              {{"{% for change in recommendations.high_priority %}"}} 
              - {{"{{"}} change.description {{"}}"}}
                • Impact: {{"{{"}} change.impact {{"}}"}}
                • Implementation: {{"{{"}} change.implementation {{"}}"}}
                • Verification: {{"{{"}} change.verification {{"}}"}}
              {{"{% endfor %}"}} 
              
              **Medium Priority Changes:**
              {{"{% for change in recommendations.medium_priority %}"}} 
              - {{"{{"}} change.description {{"}}"}}
                • Impact: {{"{{"}} change.impact {{"}}"}}
                • Implementation: {{"{{"}} change.implementation {{"}}"}}
              {{"{% endfor %}"}} 
              
              **Implementation Plan:**
              1. Review current configuration
              2. Test changes in staging environment
              3. Schedule maintenance window
              4. Apply changes incrementally
              5. Verify each change
              6. Monitor for issues
              
              **Expected Benefits:**
              - Reduced attack surface
              - Improved security posture
              - Enhanced compliance
              - Better monitoring capabilities
              
              **Estimated Implementation Time:** {{"{{"}} recommendations.implementation_time {{"}}"}}
              **Required Downtime:** {{"{{"}} recommendations.downtime_estimate {{"}}"}}
    
    # Configuration Recommendations Configuration
    configuration_recommendations:
      enabled: {{ .Values.securityRecommendationEngine.configurationRecommendations.enabled | default true }}
      
      # Configuration Sources
      sources:
        - name: "security_benchmarks"
          enabled: {{ .Values.securityRecommendationEngine.configurationRecommendations.sources.securityBenchmarks.enabled | default true }}
          benchmarks:
            - "cis_controls"
            - "nist_cybersecurity_framework"
            - "iso_27001"
            - "pci_dss"
            - "soc_2"
          update_frequency: {{ .Values.securityRecommendationEngine.configurationRecommendations.sources.securityBenchmarks.updateFrequency | default "monthly" | quote }}
          
        - name: "configuration_scanners"
          enabled: {{ .Values.securityRecommendationEngine.configurationRecommendations.sources.configurationScanners.enabled | default true }}
          scanners:
            - "kube_bench"
            - "kube_hunter"
            - "polaris"
            - "falco"
            - "open_policy_agent"
          scan_frequency: {{ .Values.securityRecommendationEngine.configurationRecommendations.sources.configurationScanners.scanFrequency | default "daily" | quote }}
          
        - name: "best_practices"
          enabled: {{ .Values.securityRecommendationEngine.configurationRecommendations.sources.bestPractices.enabled | default true }}
          sources:
            - "kubernetes_security_best_practices"
            - "container_security_best_practices"
            - "cloud_security_best_practices"
            - "network_security_best_practices"
          update_frequency: {{ .Values.securityRecommendationEngine.configurationRecommendations.sources.bestPractices.updateFrequency | default "weekly" | quote }}
      
      # Configuration Analysis
      analysis:
        # Compliance Analysis
        compliance_analysis:
          enabled: {{ .Values.securityRecommendationEngine.configurationRecommendations.analysis.complianceAnalysis.enabled | default true }}
          
          # Compliance Standards
          standards:
            - name: "cis_kubernetes"
              version: "1.7.0"
              weight: {{ .Values.securityRecommendationEngine.configurationRecommendations.analysis.complianceAnalysis.standards.cisKubernetes.weight | default 0.3 }}
              
            - name: "nist_csf"
              version: "1.1"
              weight: {{ .Values.securityRecommendationEngine.configurationRecommendations.analysis.complianceAnalysis.standards.nistCsf.weight | default 0.25 }}
              
            - name: "pci_dss"
              version: "4.0"
              weight: {{ .Values.securityRecommendationEngine.configurationRecommendations.analysis.complianceAnalysis.standards.pciDss.weight | default 0.2 }}
              
            - name: "soc_2"
              version: "2017"
              weight: {{ .Values.securityRecommendationEngine.configurationRecommendations.analysis.complianceAnalysis.standards.soc2.weight | default 0.15 }}
              
            - name: "iso_27001"
              version: "2022"
              weight: {{ .Values.securityRecommendationEngine.configurationRecommendations.analysis.complianceAnalysis.standards.iso27001.weight | default 0.1 }}
          
          # Compliance Scoring
          scoring:
            method: {{ .Values.securityRecommendationEngine.configurationRecommendations.analysis.complianceAnalysis.scoring.method | default "weighted_average" | quote }}
            thresholds:
              excellent: {{ .Values.securityRecommendationEngine.configurationRecommendations.analysis.complianceAnalysis.scoring.thresholds.excellent | default 0.95 }}
              good: {{ .Values.securityRecommendationEngine.configurationRecommendations.analysis.complianceAnalysis.scoring.thresholds.good | default 0.80 }}
              fair: {{ .Values.securityRecommendationEngine.configurationRecommendations.analysis.complianceAnalysis.scoring.thresholds.fair | default 0.65 }}
              poor: {{ .Values.securityRecommendationEngine.configurationRecommendations.analysis.complianceAnalysis.scoring.thresholds.poor | default 0.50 }}
        
        # Security Posture Analysis
        security_posture_analysis:
          enabled: {{ .Values.securityRecommendationEngine.configurationRecommendations.analysis.securityPostureAnalysis.enabled | default true }}
          
          # Security Domains
          domains:
            - name: "identity_access_management"
              weight: {{ .Values.securityRecommendationEngine.configurationRecommendations.analysis.securityPostureAnalysis.domains.identityAccessManagement.weight | default 0.25 }}
              controls:
                - "rbac_configuration"
                - "service_account_management"
                - "authentication_policies"
                - "authorization_policies"
                
            - name: "network_security"
              weight: {{ .Values.securityRecommendationEngine.configurationRecommendations.analysis.securityPostureAnalysis.domains.networkSecurity.weight | default 0.25 }}
              controls:
                - "network_policies"
                - "ingress_configuration"
                - "service_mesh_security"
                - "tls_configuration"
                
            - name: "workload_security"
              weight: {{ .Values.securityRecommendationEngine.configurationRecommendations.analysis.securityPostureAnalysis.domains.workloadSecurity.weight | default 0.2 }}
              controls:
                - "pod_security_policies"
                - "container_security"
                - "image_security"
                - "runtime_security"
                
            - name: "data_security"
              weight: {{ .Values.securityRecommendationEngine.configurationRecommendations.analysis.securityPostureAnalysis.domains.dataSecurity.weight | default 0.15 }}
              controls:
                - "encryption_at_rest"
                - "encryption_in_transit"
                - "secrets_management"
                - "data_classification"
                
            - name: "logging_monitoring"
              weight: {{ .Values.securityRecommendationEngine.configurationRecommendations.analysis.securityPostureAnalysis.domains.loggingMonitoring.weight | default 0.15 }}
              controls:
                - "audit_logging"
                - "security_monitoring"
                - "alerting_configuration"
                - "log_retention"
        
        # Drift Detection
        drift_detection:
          enabled: {{ .Values.securityRecommendationEngine.configurationRecommendations.analysis.driftDetection.enabled | default true }}
          
          # Baseline Configuration
          baseline:
            source: {{ .Values.securityRecommendationEngine.configurationRecommendations.analysis.driftDetection.baseline.source | default "approved_configuration" | quote }}
            update_frequency: {{ .Values.securityRecommendationEngine.configurationRecommendations.analysis.driftDetection.baseline.updateFrequency | default "weekly" | quote }}
            validation_required: {{ .Values.securityRecommendationEngine.configurationRecommendations.analysis.driftDetection.baseline.validationRequired | default true }}
          
          # Drift Detection Rules
          rules:
            - name: "critical_configuration_changes"
              severity: "critical"
              conditions:
                - "security_context_changes"
                - "rbac_policy_changes"
                - "network_policy_changes"
                - "secret_configuration_changes"
              notification_required: {{ .Values.securityRecommendationEngine.configurationRecommendations.analysis.driftDetection.rules.criticalConfigurationChanges.notificationRequired | default true }}
              
            - name: "compliance_configuration_changes"
              severity: "high"
              conditions:
                - "audit_logging_changes"
                - "encryption_configuration_changes"
                - "access_control_changes"
              notification_required: {{ .Values.securityRecommendationEngine.configurationRecommendations.analysis.driftDetection.rules.complianceConfigurationChanges.notificationRequired | default true }}
              
            - name: "operational_configuration_changes"
              severity: "medium"
              conditions:
                - "resource_limit_changes"
                - "monitoring_configuration_changes"
                - "backup_configuration_changes"
              notification_required: {{ .Values.securityRecommendationEngine.configurationRecommendations.analysis.driftDetection.rules.operationalConfigurationChanges.notificationRequired | default false }}
      
      # Configuration Recommendations
      recommendations:
        # Recommendation Categories
        categories:
          - name: "security_hardening"
            description: "Security hardening recommendations"
            priority: {{ .Values.securityRecommendationEngine.configurationRecommendations.recommendations.categories.securityHardening.priority | default "high" | quote }}
            
          - name: "compliance_improvement"
            description: "Compliance improvement recommendations"
            priority: {{ .Values.securityRecommendationEngine.configurationRecommendations.recommendations.categories.complianceImprovement.priority | default "high" | quote }}
            
          - name: "operational_excellence"
            description: "Operational excellence recommendations"
            priority: {{ .Values.securityRecommendationEngine.configurationRecommendations.recommendations.categories.operationalExcellence.priority | default "medium" | quote }}
            
          - name: "performance_optimization"
            description: "Performance optimization recommendations"
            priority: {{ .Values.securityRecommendationEngine.configurationRecommendations.recommendations.categories.performanceOptimization.priority | default "medium" | quote }}
            
          - name: "cost_optimization"
            description: "Cost optimization recommendations"
            priority: {{ .Values.securityRecommendationEngine.configurationRecommendations.recommendations.categories.costOptimization.priority | default "low" | quote }}
        
        # Recommendation Scoring
        scoring:
          factors:
            - name: "security_impact"
              weight: {{ .Values.securityRecommendationEngine.configurationRecommendations.recommendations.scoring.factors.securityImpact.weight | default 0.3 }}
              
            - name: "compliance_impact"
              weight: {{ .Values.securityRecommendationEngine.configurationRecommendations.recommendations.scoring.factors.complianceImpact.weight | default 0.25 }}
              
            - name: "implementation_complexity"
              weight: {{ .Values.securityRecommendationEngine.configurationRecommendations.recommendations.scoring.factors.implementationComplexity.weight | default 0.2 }}
              
            - name: "business_impact"
              weight: {{ .Values.securityRecommendationEngine.configurationRecommendations.recommendations.scoring.factors.businessImpact.weight | default 0.15 }}
              
            - name: "cost_benefit"
              weight: {{ .Values.securityRecommendationEngine.configurationRecommendations.recommendations.scoring.factors.costBenefit.weight | default 0.1 }}
    
    # Policy Recommendations Configuration
    policy_recommendations:
      enabled: {{ .Values.securityRecommendationEngine.policyRecommendations.enabled | default true }}
      
      # Policy Sources
      sources:
        - name: "security_policies"
          enabled: {{ .Values.securityRecommendationEngine.policyRecommendations.sources.securityPolicies.enabled | default true }}
          types:
            - "network_policies"
            - "pod_security_policies"
            - "rbac_policies"
            - "admission_control_policies"
            - "security_context_policies"
          
        - name: "compliance_policies"
          enabled: {{ .Values.securityRecommendationEngine.policyRecommendations.sources.compliancePolicies.enabled | default true }}
          frameworks:
            - "cis_controls"
            - "nist_csf"
            - "pci_dss"
            - "soc_2"
            - "iso_27001"
          
        - name: "operational_policies"
          enabled: {{ .Values.securityRecommendationEngine.policyRecommendations.sources.operationalPolicies.enabled | default true }}
          types:
            - "resource_quotas"
            - "limit_ranges"
            - "priority_classes"
            - "disruption_budgets"
            - "horizontal_pod_autoscaler"
      
      # Policy Analysis
      analysis:
        # Policy Effectiveness
        effectiveness:
          enabled: {{ .Values.securityRecommendationEngine.policyRecommendations.analysis.effectiveness.enabled | default true }}
          
          # Effectiveness Metrics
          metrics:
            - name: "coverage"
              description: "Policy coverage of security controls"
              weight: {{ .Values.securityRecommendationEngine.policyRecommendations.analysis.effectiveness.metrics.coverage.weight | default 0.3 }}
              
            - name: "enforcement"
              description: "Policy enforcement effectiveness"
              weight: {{ .Values.securityRecommendationEngine.policyRecommendations.analysis.effectiveness.metrics.enforcement.weight | default 0.25 }}
              
            - name: "compliance"
              description: "Policy compliance rate"
              weight: {{ .Values.securityRecommendationEngine.policyRecommendations.analysis.effectiveness.metrics.compliance.weight | default 0.2 }}
              
            - name: "performance"
              description: "Policy performance impact"
              weight: {{ .Values.securityRecommendationEngine.policyRecommendations.analysis.effectiveness.metrics.performance.weight | default 0.15 }}
              
            - name: "maintainability"
              description: "Policy maintainability"
              weight: {{ .Values.securityRecommendationEngine.policyRecommendations.analysis.effectiveness.metrics.maintainability.weight | default 0.1 }}
        
        # Policy Gaps
        gap_analysis:
          enabled: {{ .Values.securityRecommendationEngine.policyRecommendations.analysis.gapAnalysis.enabled | default true }}
          
          # Gap Detection
          detection:
            - name: "missing_policies"
              description: "Detection of missing security policies"
              enabled: {{ .Values.securityRecommendationEngine.policyRecommendations.analysis.gapAnalysis.detection.missingPolicies.enabled | default true }}
              
            - name: "insufficient_coverage"
              description: "Detection of insufficient policy coverage"
              enabled: {{ .Values.securityRecommendationEngine.policyRecommendations.analysis.gapAnalysis.detection.insufficientCoverage.enabled | default true }}
              
            - name: "conflicting_policies"
              description: "Detection of conflicting policies"
              enabled: {{ .Values.securityRecommendationEngine.policyRecommendations.analysis.gapAnalysis.detection.conflictingPolicies.enabled | default true }}
              
            - name: "outdated_policies"
              description: "Detection of outdated policies"
              enabled: {{ .Values.securityRecommendationEngine.policyRecommendations.analysis.gapAnalysis.detection.outdatedPolicies.enabled | default true }}
        
        # Policy Optimization
        optimization:
          enabled: {{ .Values.securityRecommendationEngine.policyRecommendations.analysis.optimization.enabled | default true }}
          
          # Optimization Areas
          areas:
            - name: "performance_optimization"
              description: "Optimize policies for performance"
              weight: {{ .Values.securityRecommendationEngine.policyRecommendations.analysis.optimization.areas.performanceOptimization.weight | default 0.3 }}
              
            - name: "security_optimization"
              description: "Optimize policies for security"
              weight: {{ .Values.securityRecommendationEngine.policyRecommendations.analysis.optimization.areas.securityOptimization.weight | default 0.3 }}
              
            - name: "compliance_optimization"
              description: "Optimize policies for compliance"
              weight: {{ .Values.securityRecommendationEngine.policyRecommendations.analysis.optimization.areas.complianceOptimization.weight | default 0.2 }}
              
            - name: "operational_optimization"
              description: "Optimize policies for operations"
              weight: {{ .Values.securityRecommendationEngine.policyRecommendations.analysis.optimization.areas.operationalOptimization.weight | default 0.2 }}
    
    # Architecture Recommendations Configuration
    architecture_recommendations:
      enabled: {{ .Values.securityRecommendationEngine.architectureRecommendations.enabled | default true }}
      
      # Architecture Patterns
      patterns:
        - name: "zero_trust_architecture"
          description: "Zero Trust architecture recommendations"
          enabled: {{ .Values.securityRecommendationEngine.architectureRecommendations.patterns.zeroTrustArchitecture.enabled | default true }}
          components:
            - "identity_verification"
            - "device_verification"
            - "network_segmentation"
            - "least_privilege_access"
            - "continuous_monitoring"
          
        - name: "defense_in_depth"
          description: "Defense in depth architecture recommendations"
          enabled: {{ .Values.securityRecommendationEngine.architectureRecommendations.patterns.defenseInDepth.enabled | default true }}
          layers:
            - "perimeter_security"
            - "network_security"
            - "endpoint_security"
            - "application_security"
            - "data_security"
          
        - name: "secure_by_design"
          description: "Secure by design architecture recommendations"
          enabled: {{ .Values.securityRecommendationEngine.architectureRecommendations.patterns.secureByDesign.enabled | default true }}
          principles:
            - "principle_of_least_privilege"
            - "fail_safe_defaults"
            - "economy_of_mechanism"
            - "complete_mediation"
            - "open_design"
          
        - name: "service_mesh_security"
          description: "Service mesh security architecture recommendations"
          enabled: {{ .Values.securityRecommendationEngine.architectureRecommendations.patterns.serviceMeshSecurity.enabled | default true }}
          features:
            - "mutual_tls"
            - "service_identity"
            - "policy_enforcement"
            - "observability"
            - "traffic_management"
      
      # Architecture Analysis
      analysis:
        # Security Assessment
        security_assessment:
          enabled: {{ .Values.securityRecommendationEngine.architectureRecommendations.analysis.securityAssessment.enabled | default true }}
          
          # Assessment Dimensions
          dimensions:
            - name: "confidentiality"
              weight: {{ .Values.securityRecommendationEngine.architectureRecommendations.analysis.securityAssessment.dimensions.confidentiality.weight | default 0.25 }}
              
            - name: "integrity"
              weight: {{ .Values.securityRecommendationEngine.architectureRecommendations.analysis.securityAssessment.dimensions.integrity.weight | default 0.25 }}
              
            - name: "availability"
              weight: {{ .Values.securityRecommendationEngine.architectureRecommendations.analysis.securityAssessment.dimensions.availability.weight | default 0.25 }}
              
            - name: "accountability"
              weight: {{ .Values.securityRecommendationEngine.architectureRecommendations.analysis.securityAssessment.dimensions.accountability.weight | default 0.15 }}
              
            - name: "non_repudiation"
              weight: {{ .Values.securityRecommendationEngine.architectureRecommendations.analysis.securityAssessment.dimensions.nonRepudiation.weight | default 0.1 }}
        
        # Threat Modeling
        threat_modeling:
          enabled: {{ .Values.securityRecommendationEngine.architectureRecommendations.analysis.threatModeling.enabled | default true }}
          
          # Threat Modeling Methodologies
          methodologies:
            - name: "stride"
              enabled: {{ .Values.securityRecommendationEngine.architectureRecommendations.analysis.threatModeling.methodologies.stride.enabled | default true }}
              components:
                - "spoofing"
                - "tampering"
                - "repudiation"
                - "information_disclosure"
                - "denial_of_service"
                - "elevation_of_privilege"
              
            - name: "pasta"
              enabled: {{ .Values.securityRecommendationEngine.architectureRecommendations.analysis.threatModeling.methodologies.pasta.enabled | default true }}
              stages:
                - "define_objectives"
                - "define_technical_scope"
                - "decompose_application"
                - "analyze_threats"
                - "vulnerability_analysis"
                - "attack_modeling"
                - "risk_analysis"
              
            - name: "linddun"
              enabled: {{ .Values.securityRecommendationEngine.architectureRecommendations.analysis.threatModeling.methodologies.linddun.enabled | default true }}
              privacy_threats:
                - "linkability"
                - "identifiability"
                - "non_repudiation"
                - "detectability"
                - "disclosure_of_information"
                - "unawareness"
                - "non_compliance"
        
        # Risk Assessment
        risk_assessment:
          enabled: {{ .Values.securityRecommendationEngine.architectureRecommendations.analysis.riskAssessment.enabled | default true }}
          
          # Risk Factors
          factors:
            - name: "threat_landscape"
              weight: {{ .Values.securityRecommendationEngine.architectureRecommendations.analysis.riskAssessment.factors.threatLandscape.weight | default 0.3 }}
              
            - name: "vulnerability_exposure"
              weight: {{ .Values.securityRecommendationEngine.architectureRecommendations.analysis.riskAssessment.factors.vulnerabilityExposure.weight | default 0.25 }}
              
            - name: "asset_value"
              weight: {{ .Values.securityRecommendationEngine.architectureRecommendations.analysis.riskAssessment.factors.assetValue.weight | default 0.2 }}
              
            - name: "business_impact"
              weight: {{ .Values.securityRecommendationEngine.architectureRecommendations.analysis.riskAssessment.factors.businessImpact.weight | default 0.15 }}
              
            - name: "regulatory_impact"
              weight: {{ .Values.securityRecommendationEngine.architectureRecommendations.analysis.riskAssessment.factors.regulatoryImpact.weight | default 0.1 }}
    
    # Personalization Configuration
    personalization:
      enabled: {{ .Values.securityRecommendationEngine.personalization.enabled | default true }}
      
      # User Profiling
      user_profiling:
        enabled: {{ .Values.securityRecommendationEngine.personalization.userProfiling.enabled | default true }}
        
        # Profile Attributes
        attributes:
          - name: "role"
            type: "categorical"
            values: ["security_analyst", "system_administrator", "developer", "manager", "auditor"]
            weight: {{ .Values.securityRecommendationEngine.personalization.userProfiling.attributes.role.weight | default 0.3 }}
            
          - name: "experience_level"
            type: "ordinal"
            values: ["beginner", "intermediate", "advanced", "expert"]
            weight: {{ .Values.securityRecommendationEngine.personalization.userProfiling.attributes.experienceLevel.weight | default 0.25 }}
            
          - name: "security_focus"
            type: "categorical"
            values: ["infrastructure", "application", "data", "compliance", "operations"]
            weight: {{ .Values.securityRecommendationEngine.personalization.userProfiling.attributes.securityFocus.weight | default 0.2 }}
            
          - name: "risk_tolerance"
            type: "ordinal"
            values: ["conservative", "moderate", "aggressive"]
            weight: {{ .Values.securityRecommendationEngine.personalization.userProfiling.attributes.riskTolerance.weight | default 0.15 }}
            
          - name: "automation_preference"
            type: "ordinal"
            values: ["manual", "semi_automated", "fully_automated"]
            weight: {{ .Values.securityRecommendationEngine.personalization.userProfiling.attributes.automationPreference.weight | default 0.1 }}
        
        # Profile Learning
        learning:
          enabled: {{ .Values.securityRecommendationEngine.personalization.userProfiling.learning.enabled | default true }}
          
          # Learning Sources
          sources:
            - "user_actions"
            - "feedback_data"
            - "interaction_patterns"
            - "preference_settings"
            - "historical_behavior"
          
          # Learning Algorithms
          algorithms:
            - name: "collaborative_filtering"
              enabled: {{ .Values.securityRecommendationEngine.personalization.userProfiling.learning.algorithms.collaborativeFiltering.enabled | default true }}
              
            - name: "content_based_filtering"
              enabled: {{ .Values.securityRecommendationEngine.personalization.userProfiling.learning.algorithms.contentBasedFiltering.enabled | default true }}
              
            - name: "matrix_factorization"
              enabled: {{ .Values.securityRecommendationEngine.personalization.userProfiling.learning.algorithms.matrixFactorization.enabled | default true }}
              
            - name: "deep_learning"
              enabled: {{ .Values.securityRecommendationEngine.personalization.userProfiling.learning.algorithms.deepLearning.enabled | default true }}
      
      # Recommendation Customization
      customization:
        enabled: {{ .Values.securityRecommendationEngine.personalization.customization.enabled | default true }}
        
        # Customization Factors
        factors:
          - name: "user_preferences"
            weight: {{ .Values.securityRecommendationEngine.personalization.customization.factors.userPreferences.weight | default 0.3 }}
            
          - name: "historical_feedback"
            weight: {{ .Values.securityRecommendationEngine.personalization.customization.factors.historicalFeedback.weight | default 0.25 }}
            
          - name: "role_based_requirements"
            weight: {{ .Values.securityRecommendationEngine.personalization.customization.factors.roleBasedRequirements.weight | default 0.2 }}
            
          - name: "organizational_policies"
            weight: {{ .Values.securityRecommendationEngine.personalization.customization.factors.organizationalPolicies.weight | default 0.15 }}
            
          - name: "peer_behavior"
            weight: {{ .Values.securityRecommendationEngine.personalization.customization.factors.peerBehavior.weight | default 0.1 }}
        
        # Customization Rules
        rules:
          - name: "priority_adjustment"
            description: "Adjust recommendation priorities based on user preferences"
            enabled: {{ .Values.securityRecommendationEngine.personalization.customization.rules.priorityAdjustment.enabled | default true }}
            
          - name: "content_filtering"
            description: "Filter recommendations based on user role and permissions"
            enabled: {{ .Values.securityRecommendationEngine.personalization.customization.rules.contentFiltering.enabled | default true }}
            
          - name: "complexity_adjustment"
            description: "Adjust recommendation complexity based on user experience"
            enabled: {{ .Values.securityRecommendationEngine.personalization.customization.rules.complexityAdjustment.enabled | default true }}
            
          - name: "automation_matching"
            description: "Match automation level to user preferences"
            enabled: {{ .Values.securityRecommendationEngine.personalization.customization.rules.automationMatching.enabled | default true }}
      
      # Feedback Integration
      feedback_integration:
        enabled: {{ .Values.securityRecommendationEngine.personalization.feedbackIntegration.enabled | default true }}
        
        # Feedback Types
        types:
          - name: "explicit_feedback"
            description: "Direct user feedback on recommendations"
            enabled: {{ .Values.securityRecommendationEngine.personalization.feedbackIntegration.types.explicitFeedback.enabled | default true }}
            collection_methods:
              - "rating_system"
              - "thumbs_up_down"
              - "comments"
              - "surveys"
            
          - name: "implicit_feedback"
            description: "Inferred feedback from user behavior"
            enabled: {{ .Values.securityRecommendationEngine.personalization.feedbackIntegration.types.implicitFeedback.enabled | default true }}
            collection_methods:
              - "click_through_rates"
              - "implementation_rates"
              - "dwell_time"
              - "navigation_patterns"
            
          - name: "outcome_feedback"
            description: "Feedback based on recommendation outcomes"
            enabled: {{ .Values.securityRecommendationEngine.personalization.feedbackIntegration.types.outcomeFeedback.enabled | default true }}
            collection_methods:
              - "security_improvements"
              - "incident_reduction"
              - "compliance_improvements"
              - "operational_efficiency"
        
        # Feedback Processing
        processing:
          # Feedback Analysis
          analysis:
            enabled: {{ .Values.securityRecommendationEngine.personalization.feedbackIntegration.processing.analysis.enabled | default true }}
            
            # Analysis Methods
            methods:
              - "sentiment_analysis"
              - "topic_modeling"
              - "correlation_analysis"
              - "trend_analysis"
              - "anomaly_detection"
          
          # Feedback Incorporation
          incorporation:
            enabled: {{ .Values.securityRecommendationEngine.personalization.feedbackIntegration.processing.incorporation.enabled | default true }}
            
            # Incorporation Strategies
            strategies:
              - name: "real_time_updates"
                description: "Real-time incorporation of feedback"
                enabled: {{ .Values.securityRecommendationEngine.personalization.feedbackIntegration.processing.incorporation.strategies.realTimeUpdates.enabled | default true }}
                
              - name: "batch_updates"
                description: "Batch incorporation of feedback"
                enabled: {{ .Values.securityRecommendationEngine.personalization.feedbackIntegration.processing.incorporation.strategies.batchUpdates.enabled | default true }}
                frequency: {{ .Values.securityRecommendationEngine.personalization.feedbackIntegration.processing.incorporation.strategies.batchUpdates.frequency | default "daily" | quote }}
                
              - name: "model_retraining"
                description: "Periodic model retraining with feedback"
                enabled: {{ .Values.securityRecommendationEngine.personalization.feedbackIntegration.processing.incorporation.strategies.modelRetraining.enabled | default true }}
                frequency: {{ .Values.securityRecommendationEngine.personalization.feedbackIntegration.processing.incorporation.strategies.modelRetraining.frequency | default "weekly" | quote }}
    
    # Monitoring Configuration
    monitoring:
      enabled: {{ .Values.securityRecommendationEngine.monitoring.enabled | default true }}
      
      # Metrics
      metrics:
        - name: "recommendations_generated"
          type: "counter"
          description: "Total number of recommendations generated"
          
        - name: "recommendation_accuracy"
          type: "gauge"
          description: "Accuracy of recommendations"
          
        - name: "user_satisfaction"
          type: "gauge"
          description: "User satisfaction with recommendations"
          
        - name: "implementation_rate"
          type: "gauge"
          description: "Rate of recommendation implementation"
          
        - name: "recommendation_latency"
          type: "histogram"
          description: "Time taken to generate recommendations"
          
        - name: "personalization_effectiveness"
          type: "gauge"
          description: "Effectiveness of personalization"
      
      # Alerting
      alerting:
        enabled: {{ .Values.securityRecommendationEngine.monitoring.alerting.enabled | default true }}
        
        # Alert Rules
        rules:
          - name: "low_recommendation_accuracy"
            condition: "recommendation_accuracy < 0.7"
            severity: "warning"
            description: "Recommendation accuracy is below threshold"
            
          - name: "low_user_satisfaction"
            condition: "user_satisfaction < 0.6"
            severity: "warning"
            description: "User satisfaction is below threshold"
            
          - name: "low_implementation_rate"
            condition: "implementation_rate < 0.3"
            severity: "warning"
            description: "Implementation rate is below threshold"
            
          - name: "high_recommendation_latency"
            condition: "recommendation_latency_p95 > 5"
            severity: "critical"
            description: "Recommendation generation latency is too high"
        
        # Notification Channels
        channels:
          - name: "slack"
            enabled: {{ .Values.securityRecommendationEngine.monitoring.alerting.channels.slack.enabled | default true }}
            webhook_url: {{ .Values.securityRecommendationEngine.monitoring.alerting.channels.slack.webhookUrl | default "" | quote }}
            channel: {{ .Values.securityRecommendationEngine.monitoring.alerting.channels.slack.channel | default "#security-recommendations" | quote }}
            
          - name: "email"
            enabled: {{ .Values.securityRecommendationEngine.monitoring.alerting.channels.email.enabled | default true }}
            recipients:
              - "security-team@alt.production.local"
              - "platform-team@alt.production.local"