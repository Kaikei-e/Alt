# .github/workflows/vitest.yaml
name: Unit Tests for Alt Frontend

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main, develop ]
  workflow_dispatch:

permissions:
  contents: read

jobs:
  unit-tests:
    name: Unit Tests
    runs-on: ubuntu-latest
    timeout-minutes: 20

    steps:
    - uses: actions/checkout@v4

    - uses: pnpm/action-setup@v4
      with:
        version: 8
        run_install: false
        node-version: 24

    - uses: actions/setup-node@v4
      with:
        node-version: 24
        cache: 'pnpm'

    - name: Install dependencies
      run: pnpm ci

    - name: Run middleware tests
      run: pnpm run test:middleware
      env:
        NODE_OPTIONS: '--max-old-space-size=2048'

    - name: Run component tests
      run: pnpm run test:ci
      env:
        NODE_OPTIONS: '--max-old-space-size=4096 --expose-gc'
        CI: true

  security-scan:
    name: Security Scan
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v4

    - uses: actions/setup-node@v4
      with:
        node-version: 24
        cache: 'pnpm'

    - name: Install dependencies
      run: pnpm ci

    - name: Run security tests
      run: pnpm run test:run -- src/tests/security/
      env:
        NODE_OPTIONS: '--max-old-space-size=2048'