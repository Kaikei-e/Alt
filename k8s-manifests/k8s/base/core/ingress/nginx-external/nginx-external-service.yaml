apiVersion: v1
kind: Service
metadata:
  name: nginx-external
  labels:
    app: nginx-external
    component: ingress
    tier: infrastructure
  annotations:
    # パフォーマンス最適化
    service.kubernetes.io/topology-mode: Auto
    # セキュリティ関連
    service.alpha.kubernetes.io/tolerate-unready-endpoints: "false"
spec:
  type: ClusterIP
  selector:
    app: nginx-external
    component: ingress
  
  ports:
    - name: http
      port: 8080
      targetPort: 8080
      protocol: TCP
  
  # セッション親和性（必要に応じて）
  sessionAffinity: None
  
  # IPファミリー設定
  ipFamilyPolicy: SingleStack
  ipFamilies:
    - IPv4