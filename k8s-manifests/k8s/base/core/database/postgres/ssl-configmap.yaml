apiVersion: v1
kind: ConfigMap
metadata:
  labels:
    app.kubernetes.io/component: database
    app.kubernetes.io/part-of: postgres
    io.kompose.service: db
  name: postgres-ssl-config
data:
  # PostgreSQL SSL configuration
  postgresql.conf: |
    # SSL Configuration
    ssl = on
    ssl_cert_file = '/var/lib/postgresql/ssl/server.crt'
    ssl_key_file = '/var/lib/postgresql/ssl/server.key'
    ssl_ca_file = '/var/lib/postgresql/ssl/ca.crt'
    ssl_ciphers = 'HIGH:MEDIUM:+3DES:!aNULL'
    ssl_prefer_server_ciphers = on
    ssl_min_protocol_version = 'TLSv1.2'
    ssl_max_protocol_version = 'TLSv1.3'

    # SSL session cache
    ssl_session_cache_mode = on
    ssl_session_cache_size = 1MB
    ssl_session_timeout = 300

    # Require SSL for all connections
    ssl_renegotiation_limit = 0

    # Log SSL connections
    log_connections = on
    log_disconnections = on
    log_statement = 'all'

    # Performance tuning for SSL
    shared_preload_libraries = 'pg_stat_statements'
    pg_stat_statements.track = all
    pg_stat_statements.max = 10000
    pg_stat_statements.track_utility = on