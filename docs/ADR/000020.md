# alt-frontend-sv FeedDetailsコンポーネントの可読性リファクタリング：ガラスモーフィズムから紙スタイルへ

## ステータス

採択（Accepted） - 2025年12月28日

## コンテキスト

2025年12月下旬、alt-frontend-svのモバイルフィードDetails画面において、深刻な可読性の問題が発見された。

### 問題の発見

ユーザーからのフィードバックとスクリーンショット分析により、以下の重大な問題が判明：

1. **WCAG基準違反の極端に低いコントラスト**
   - テキストが白色 on `rgba(255,255,255,0.1)` の透明背景
   - コントラスト比: **約2:1** （WCAG AA基準の4.5:1を大幅に下回る）
   - 実質的に「読めない」レベルの視認性

2. **Alt-Paperテーマの誤実装**
   - ガラスモーフィズム（glassmorphism）を使用していた
   - Alt-Paperテーマは新聞風の**ソリッドな紙スタイル**が本来の設計
   - テーマ変数 `--alt-glass` は #dedede（ソリッド）と定義されているのに、実装では透明背景を使用

3. **不整合なデザイン**
   - FeedDetailsのモーダル: 透明ガラス背景（読めない）
   - RenderFeedDetailsの記事セクション: ソリッド #f5f5f5 背景（21:1コントラスト、完璧）
   - 同一コンポーネント内で相反するデザイン哲学

4. **過剰なブラー効果**
   - `backdrop-blur-[20px]` により既に低いコントラストがさらに悪化
   - 「霧がかかった」ような視覚効果で目の疲労を誘発

### 技術的背景

```typescript
// 問題のあった実装
<Sheet.Content
  class="bg-[var(--alt-glass)] text-[var(--alt-text-primary)]
         backdrop-blur-[20px] ..."
>
  <Sheet.Header
    class="bg-[rgba(255,255,255,0.03)] backdrop-blur-[20px] ..."
  >
```

- `var(--alt-glass)`: 実装では透明だったが、テーマ定義は #dedede（ソリッド）
- `var(--alt-text-primary)`: 未定義変数（正しくは `--text-primary`）
- Header背景: わずか3%の不透明度

### 既存の成功例

コードベース内には正しい実装例が存在していた：

**RecapCard.svelte:**
```svelte
<div style="background: var(--surface-bg);">  <!-- #dedede -->
  <p style="color: var(--text-primary);">     <!-- #1a1a1a -->
```
→ コントラスト比: **10:1** (WCAG AAA)

**RenderFeedDetails Article Section:**
```svelte
<div style="background: #f5f5f5; color: #1a1a1a;">
```
→ コントラスト比: **21:1** (AAA+++)

## 決定

FeedDetailsコンポーネントを**完全リファクタリング**し、Alt-Paperテーマの設計哲学に準拠した紙スタイルに変更する。

### フェーズ1: ソリッドな紙スタイルへの変換

#### 1.1 Sheet.Content背景

**変更前:**
```svelte
class="bg-[var(--alt-glass)] text-[var(--alt-text-primary)]
       border-2 border-[var(--alt-glass-border)]
       backdrop-blur-[20px] ..."
```

**変更後:**
```svelte
class="bg-surface-bg text-text-primary
       border-2 border-surface-border
       shadow-2xl rounded-2xl p-4 ..."
```

**効果:**
- 背景: 透明 → `#dedede` ソリッド
- テキスト: 未定義変数 → `#1a1a1a` ソリッド
- ブラー: 20px → 完全削除
- コントラスト: 2:1 → **10:1** (WCAG AAA)

#### 1.2 Headerスタイリング

**変更前:**
```svelte
class="bg-[rgba(255,255,255,0.03)] backdrop-blur-[20px]
       border-b border-[var(--alt-glass-border)] ..."
```

**変更後:**
```svelte
class="bg-white border-b-2 border-surface-border ..."
<Sheet.Title class="text-xl font-bold text-text-primary ...">
```

**効果:**
- 背景: 3%不透明 → 完全な白（ソリッド）
- タイトルサイズ: `text-lg` → `text-xl` (視覚階層強化)
- ボーダー: `border-b` → `border-b-2` (明確な区切り)

#### 1.3 コンテンツエリア

**追加:**
```svelte
class="... bg-[#f8f8f8] ..."
```

**効果:**
- 薄いグレー背景でヘッダー/フッターとの視覚的分離
- 読みやすさを損なわない微妙なトーン変化

#### 1.4 Summaryカードリデザイン

**変更前:**
```svelte
<div class="... border-2 glass ..."
     style="border-color: var(--surface-border);
            background: var(--surface-bg);">
  <h3 style="color: var(--text-primary);">
    <Sparkles class="text-purple-500" />
```

**変更後:**
```svelte
<div class="... border-2 border-alt-primary bg-white shadow-md">
  <div class="flex items-center gap-2 mb-3 pb-2
              border-b border-surface-border">
    <Sparkles class="text-alt-primary" />
    <h3 class="text-lg font-bold text-text-primary">
```

**効果:**
- `.glass` クラス削除 → 完全なソリッド白背景
- ボーダー色: グレー → `#2f4f4f` (プライマリカラー、視覚的強調)
- 内部ヘッダーディバイダー追加 (視覚階層)
- アイコン色: 紫 → プライマリカラー (一貫性)

#### 1.5 Footerスタイリング

**変更前:**
```svelte
class="bg-[rgba(0,0,0,0.25)] backdrop-blur-[20px]
       border-t border-[var(--alt-glass-border)]
       shadow-[0_-4px_20px_rgba(0,0,0,0.3)]"
```

**変更後:**
```svelte
class="bg-[#e8e8e8] border-t-2 border-surface-border ..."
```

**効果:**
- 背景: 25%黒透明 → `#e8e8e8` ソリッドライトグレー
- ブラー削除 → クリーンな外観
- ボーダー強化 → 明確な区切り

#### 1.6 ボタンのカラーとコントラスト修正

**変更前:**
```svelte
<!-- Favorite/Archive -->
<Button class="border-white/20 text-white
               hover:bg-white/10 hover:text-white ...">

<!-- Summary -->
<Button class="bg-[rgba(255,255,255,0.15)] text-white
               hover:bg-white/20 ...">
```

**変更後:**
```svelte
<!-- Favorite/Archive -->
<Button class="border-alt-secondary text-text-primary
               hover:bg-alt-secondary hover:text-white ...">

<!-- Summary -->
<Button class="bg-alt-primary text-white
               hover:bg-alt-secondary active:scale-95 ...">
```

**効果:**
- 透明背景 → ソリッドプライマリ/セカンダリカラー
- 白テキスト → 暗いテキスト（通常状態）
- 明確な視覚階層とアクション性

### フェーズ2: RenderFeedDetailsの修正

#### メタデータカード

**変更前:**
```svelte
<div class="... border"
     style="background: rgba(255, 255, 255, 0.05);
            border-color: var(--alt-glass-border);">
  <h2 style="color: var(--alt-text-primary);">
```

**変更後:**
```svelte
<div class="... border-2 border-surface-border
            bg-white shadow-sm">
  <h2 class="text-xl font-bold text-text-primary ...">
```

**効果:**
- 5%透明 → 完全な白ソリッド背景
- 適切なテキストカラー変数
- シャドウで紙のような質感

### フェーズ3: スクロールバー視認性向上

**変更前:**
```css
:global(.scrollable-content::-webkit-scrollbar) {
  width: 4px;
}
:global(.scrollable-content::-webkit-scrollbar-thumb) {
  background: rgba(255, 255, 255, 0.2);  /* ほぼ見えない */
}
```

**変更後:**
```css
:global(.scrollable-content::-webkit-scrollbar) {
  width: 6px;
}
:global(.scrollable-content::-webkit-scrollbar-track) {
  background: #f0f0f0;
}
:global(.scrollable-content::-webkit-scrollbar-thumb) {
  background: #999999;  /* 明確に見える */
}
:global(.scrollable-content::-webkit-scrollbar-thumb:hover) {
  background: #666666;
}
```

**効果:**
- 幅増加: 4px → 6px
- トラック: 透明 → `#f0f0f0` (明確)
- サム: 20%白 → `#999999` (視認可能)
- ホバー時さらに暗く

### フェーズ4: タイポグラフィ改善

**追加:**
```css
/* テキストレンダリング最適化 */
:global(.scrollable-content) {
  font-smoothing: antialiased;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  text-rendering: optimizeLegibility;
}

/* 読みやすさ向上 */
:global(.scrollable-content p) {
  line-height: 1.7;
  margin-bottom: 1em;
}

/* 見出し階層 */
:global(.scrollable-content h1),
:global(.scrollable-content h2),
:global(.scrollable-content h3) {
  font-weight: 700;
  color: var(--text-primary);
  margin-top: 1.5em;
  margin-bottom: 0.5em;
}
```

**効果:**
- アンチエイリアス有効化 → 滑らかなテキスト
- 行間1.7 → 快適な読書体験
- 見出し階層明確化 → 視覚的構造

## 結果・影響

### 利点

1. **WCAG AAA準拠の達成**
   - すべてのテキストで **7:1以上** のコントラスト比
   - アクセシビリティ基準を完全に満たす
   - 視覚障害を持つユーザーにも配慮

2. **Alt-Paperテーマへの正しい準拠**
   - 新聞風の紙スタイルを正しく実装
   - テーマ変数を正しく使用
   - デザインシステムの一貫性確保

3. **大幅な読みやすさ向上**
   - Before: 「読めない」レベル（コントラスト2:1）
   - After: 「完璧に読める」（コントラスト10:1+）
   - 長時間の読書でも目の疲れを軽減

4. **パフォーマンス改善**
   - `backdrop-blur` 削除によるGPU負荷軽減
   - レンダリングパフォーマンス向上
   - よりスムーズなスクロール

5. **デザイン一貫性**
   - RecapCard、FeedCardなど他コンポーネントと統一
   - コードベース全体でソリッド背景使用
   - ユーザー体験の予測可能性向上

6. **メンテナンス性向上**
   - 正しいCSS変数の使用
   - 未定義変数の削除
   - 明確なデザイントークン

### 注意点・トレードオフ

1. **視覚的ダイナミズムの低下**
   - ガラスモーフィズムの「モダンな」外観を失う
   - よりクラシックな紙スタイルに
   - **判断**: 可読性 > 見た目の新しさ

2. **既存ユーザーへの変更**
   - 慣れ親しんだ外観の変更
   - 短期的な混乱の可能性
   - **対策**: 機能的には同一、より読みやすい

3. **他画面との一時的な不整合**
   - FeedDetailsのみリファクタリング
   - 他の画面は段階的に更新予定
   - **計画**: 全コンポーネントへの展開

4. **ダークモード対応の必要性**
   - 現在はAlt-Paper（ライト）のみ対応
   - Vaporwave、Liquid-Beigeテーマは今後対応
   - **TODO**: マルチテーマ対応の検討

## 参考

### 変更ファイル

1. `alt-frontend-sv/src/lib/components/mobile/FeedDetails.svelte`
   - 背景/カラーの完全刷新
   - ガラスモーフィズム完全削除
   - テキストカラー変数修正
   - ボタンスタイル更新
   - スクロールバー視認性向上
   - タイポグラフィ改善

2. `alt-frontend-sv/src/lib/components/mobile/RenderFeedDetails.svelte`
   - メタデータカード背景修正
   - ソリッド背景一貫性確保
   - テキストカラー参照修正

### 設計原則

1. **アクセシビリティファースト**: WCAG AAA準拠を最優先
2. **テーマ準拠**: Alt-Paperの紙スタイル哲学を尊重
3. **一貫性**: 既存の成功パターン（RecapCard）を踏襲
4. **可読性 > 装飾**: 機能性を美学より優先
5. **パフォーマンス**: 不要なブラー効果を削除

### 関連ADR

- このADRはalt-frontend-svのデザインシステム改善の第一歩
- 今後、他のモバイルコンポーネントも同様の原則で更新予定
- SwipeFeedCardなど、適切にガラス効果を使用している箇所は維持

### コミット

- 実装日: 2025年12月28日
- 影響範囲: FeedDetailsモーダル、RenderFeedDetails
- テスト: `/sv/mobile/feeds/viewed` での目視確認

## 総括

FeedDetailsコンポーネントのリファクタリングにより、alt-frontend-svは「見た目優先」から「可読性優先」のデザイン哲学へと明確にシフトした。この変更は単なるUI調整ではなく、**アクセシビリティとユーザビリティを最優先する**というAltプロジェクトの価値観を体現するものである。

ガラスモーフィズムは視覚的には魅力的だが、実用性に欠けることが証明された。Alt-Paperテーマの新聞風紙スタイルは、長時間の読書に適した、目に優しいデザインを提供する。この決定は、Altが「AIを活用した読書プラットフォーム」として、ユーザーの健康と快適性を重視することを示している。
