# Mobile Recap Job-Status UI の実装

## ADR's STATUS

Accepted

## CONTEXT

### 背景

デスクトップ版 `/desktop/recap/job-status` ダッシュボードは存在するが、モバイル向けの UI が未実装だった。モバイルユーザーがRecapジョブの進行状況を確認・操作できるようにする必要があった。

### 要件

1. デスクトップ版のデザインを踏襲しつつ、モバイル向けに最適化
2. 2025年のモバイルダッシュボードベストプラクティスに準拠
3. 既存のコンポーネント・フック（`useJobProgress`）を再利用
4. TDD アプローチで開発

## DECISION MAKING

### モバイル最適化方針

| デスクトップ | モバイル | 理由 |
|------------|---------|------|
| テーブル形式のジョブ履歴 | カードリスト | 横幅制約、タップ操作に適合 |
| 水平パイプラインバー | 垂直ステッパー | 縦方向スクロールに適合 |
| 3カラムグリッド | 2カラムグリッド | 375px幅での視認性確保 |
| ヘッダー内コントロール | 固定下部コントロールバー | 片手操作、親指リーチ圏内 |
| クリックで行展開 | タップでボトムシート | モバイルの標準的なディスクロージャパターン |

### 適用したベストプラクティス

| パターン | 実装 |
|---------|------|
| Progressive Disclosure | 詳細はボトムシートで表示 |
| Visual Hierarchy | KPIを上部配置、Z-scanningパターン |
| Bottom Navigation | 固定下部コントロールバー（safe-area対応） |
| Touch-Friendly | 44px以上のタップターゲット（h-12 = 48px） |
| Performance | 水平スクロール統計行、遅延読み込み |

### 代替案

1. **レスポンシブ単一ページ**: デスクトップと同じページをCSS Media Queryで対応 → 却下。モバイル特有のインタラクション（ボトムシート、垂直ステッパー）が実装困難
2. **React Native/Capacitor**: ネイティブアプリ化 → 却下。Web優先の方針、既存SvelteKitエコシステムの活用

## RESULTS, EFFECTS

### ファイル構成

```
alt-frontend-sv/src/
├── routes/mobile/recap/job-status/
│   └── +page.svelte
│
├── lib/components/mobile/recap/job-status/
│   ├── index.ts
│   ├── MobileJobStatusHeader.svelte
│   ├── MobileStatsRow.svelte
│   ├── MobileActiveJobPanel.svelte
│   ├── MobilePipelineProgress.svelte
│   ├── MobileGenreProgressGrid.svelte
│   ├── MobileJobHistoryList.svelte
│   ├── MobileJobCard.svelte
│   ├── MobileJobDetailSheet.svelte
│   ├── MobileStageDurationList.svelte
│   └── MobileControlBar.svelte
│
└── tests/e2e/mobile/recap/
    └── job-status.spec.ts
```

### コンポーネント設計

| コンポーネント | 役割 |
|--------------|------|
| `MobileJobStatusHeader` | タイトル + 水平スクロール時間ウィンドウセレクター |
| `MobileStatsRow` | 120px幅カード×4の水平スクロール統計行 |
| `MobileActiveJobPanel` | 折りたたみ可能なアクティブジョブパネル |
| `MobilePipelineProgress` | 垂直ステッパー形式のパイプライン進捗 |
| `MobileGenreProgressGrid` | 2カラムのジャンル進捗グリッド |
| `MobileJobCard` | タップ可能なジョブカード |
| `MobileJobHistoryList` | カードベースのジョブ履歴リスト |
| `MobileJobDetailSheet` | ボトムシートでのジョブ詳細表示 |
| `MobileStageDurationList` | コンパクトなステージ期間バー |
| `MobileControlBar` | 固定下部のRefresh/Start Jobボタン |

### 再利用したコンポーネント

| コンポーネント | パス |
|--------------|------|
| `StatusBadge` | `$lib/components/desktop/recap/job-status` |
| `StatusTransitionTimeline` | `$lib/components/desktop/recap/job-status` |
| `useJobProgress` | `$lib/hooks/useJobProgress.svelte.ts` |
| `Sheet` | `$lib/components/ui/sheet` |

### テスト結果

| カテゴリ | テスト数 | 結果 |
|---------|---------|------|
| Mobile Job Status | 38 | Pass |
| Desktop Job Status | 32 | Pass（リグレッションなし） |

### PROS

1. **UX向上**: モバイルユーザーがRecapジョブを操作可能に
2. **コード再利用**: 既存フック・ユーティリティを活用（約40%のロジック共有）
3. **アクセシビリティ**: ARIA属性、キーボードナビゲーション対応
4. **保守性**: デスクトップ版と並行して独立したコンポーネント構成

### CONS, TRADEOFF

1. **コンポーネント重複**: 一部のUI要素（StatusBadge等）はデスクトップ版を直接使用、モバイル専用版の作成は見送り
2. **バンドルサイズ**: 新規10コンポーネント追加により増加（約35KB）
3. **テスト実行時間**: E2Eテスト38件追加により全体実行時間が約30秒増加

## APPENDIX

### アクセス方法

1. FloatingMenu → Recap → Job Status
2. 直接URL: `/sv/mobile/recap/job-status`

### 主要なインタラクション

```
[統計行] → 水平スワイプで全カード表示
[ジョブカード] → タップでボトムシート開く
[アクティブジョブ] → ヘッダータップで折りたたみ
[下部バー] → Refresh/Start Job操作
```

### 参考資料

- [Intuitive Mobile Dashboard UI: Best Practices (Toptal)](https://www.toptal.com/designers/dashboard-design/mobile-dashboard-ui)
- [Dashboard Design: Best Practices (Justinmind)](https://www.justinmind.com/ui-design/dashboard-design-best-practices-ux)
- [Mobile Dashboard Design Tips (ANODA)](https://www.anoda.mobi/ux-blog/effective-mobile-dashboard-design-tips)
