# Feed Search UI 改善 & 無限スクロール信頼性向上

## ADR's STATUS

Accepted

## CONTEXT

### 背景

フィード検索機能において、2つのUX問題が報告されていた。

### 問題1: カード境界の視認性不足

alt-paper テーマにおいて、検索結果カードの境界がほぼ見えない状態だった。

| 要素 | 色コード | 問題 |
|------|----------|------|
| ページ背景 | `#e4e3e3` | - |
| カード背景 | `var(--alt-glass)` ≈ `#dedede` | 背景との差が小さい |
| カード境界線 | `var(--alt-glass-border)` ≈ `#e0e0e0` | 1px で視認困難 |

### 問題2: 無限スクロールの不発火

20件以上の検索結果がある場合、追加読み込みが発生しないことがあった。

| 項目 | 状態 |
|------|------|
| バックエンドAPI | 正常（`hasMore`, `nextCursor` 返却） |
| IntersectionObserver | 設定済み |
| Sentinel要素 | 高さ10pxで検出されにくい |
| フォールバック | なし |

## DECISION MAKING

### 検討したアプローチ

#### UI改善

| Option | 内容 | 評価 |
|--------|------|------|
| A: 白背景 + 強い境界線 | 固定色でコントラスト確保 | 採用 |
| B: CSS変数の調整 | テーマ変数の値を変更 | 不採用（他コンポーネントへの影響大） |
| C: アウトライン強調 | outline プロパティ使用 | 不採用（hover時の挙動が複雑） |

#### 無限スクロール

| Option | 内容 | 評価 |
|--------|------|------|
| A: Sentinel拡大 + ボタンフォールバック | 検出率向上 + 手動操作を保証 | 採用 |
| B: Sentinel拡大のみ | 高さを増やすだけ | 不採用（完全な解決にならない） |
| C: ボタンのみ | 無限スクロール廃止 | 不採用（UX低下） |

### 採用理由

**Option A を両方で採用**:

1. **UI**: 白背景（`#ffffff`）は最も高いコントラストを提供し、どのテーマでも視認性を確保
2. **無限スクロール**: Sentinel拡大で自動読み込み率を向上しつつ、ボタンで確実な操作を保証

## RESULTS, EFFECTS

### 修正ファイル

| ファイル | 変更内容 |
|----------|----------|
| `src/lib/components/mobile/search/SearchResultItem.svelte` | カードスタイリング変更 |
| `src/lib/components/mobile/search/SearchResults.svelte` | Sentinel高さ変更、Load Moreボタン追加 |

### スタイル変更詳細

#### SearchResultItem.svelte

| プロパティ | Before | After |
|------------|--------|-------|
| background | `var(--alt-glass)` | `#ffffff` |
| border | `1px solid var(--alt-glass-border)` | `2px solid #d0d0d0` |
| box-shadow | `var(--alt-glass-shadow)` | `0 2px 8px rgba(0,0,0,0.08), 0 1px 2px rgba(0,0,0,0.04)` |
| border-radius | `rounded-[24px]` | `rounded-2xl` |

#### SearchResults.svelte

| プロパティ | Before | After |
|------------|--------|-------|
| カード間gap | `gap-6` | `gap-4` |
| Sentinel高さ | `10px` | `50px` |
| Load Moreボタン | なし | 追加（フォールバック用） |

### PROS

1. **視認性向上**: 白背景と強い境界線により、カードが明確に識別可能
2. **操作の確実性**: 無限スクロール不発火時もボタンで追加読み込み可能
3. **後方互換性**: 既存の機能・APIに変更なし

### CONS, TRADEOFF

1. **テーマ非依存の固定色**: カードのみテーマ変数を使用しない（意図的な設計判断）
2. **視覚的一貫性**: glass スタイルから外れるが、視認性を優先

## APPENDIX

### デプロイ手順

```bash
docker compose -f compose/compose.yaml -p alt build alt-frontend-sv
docker compose -f compose/compose.yaml -p alt up -d alt-frontend-sv
```

### 検証方法

1. **視覚確認**: 検索ページでカードの境界が明確に見えることを確認
2. **無限スクロール**: 20件以上ヒットするクエリで追加読み込みを確認
3. **フォールバック**: 自動読み込み不発火時に「Load More Results」ボタンが表示されることを確認

### 型チェック

```bash
cd alt-frontend-sv
bun run check
# 結果: 0 errors
```
