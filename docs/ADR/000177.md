# Tag Trail Desktop UI 改善

## ADR's STATUS

Accepted

## CONTEXT

### 問題点

Tag Trail機能のDesktop UIにおいて、以下のUX課題が存在していた:

| 課題 | 影響 |
|------|------|
| サイドバーとコンテンツ間の余計な空白 | 画面の有効活用ができない |
| トレイル履歴の視覚化不足 | ユーザーが探索経路を把握しにくい |
| ブレッドクラムのみの履歴表示 | 長いトレイルで視認性が低下 |

### 既存のUI構造

```
┌─────────────────────────────────────────┐
│ Header                                   │
├─────────────────────────────────────────┤
│ Breadcrumb: Start > Feed > Tag1 > Tag2  │  ← テキストベースのみ
├────────────┬────────────────────────────┤
│            │                            │
│ Feed Card  │    Article Grid            │
│ + Tags     │                            │
│            │                            │
└────────────┴────────────────────────────┘
```

## DECISION MAKING

### 改善アプローチ

1. **レイアウトパディングの最適化**
   - `DesktopLayout`の`p-6`パディングをページ単位で制御可能に
   - Tag Trailページでは`p-0`を指定し、コンポーネント内部でパディングを管理

2. **トレイル履歴カードの追加**
   - 左パネルにビジュアルなトレイル履歴セクションを追加
   - 水平スクロール可能なカード形式で各ホップを表示

### 新UI構造

```
┌─────────────────────────────────────────┐
│ Header                                   │
├────────────┬────────────────────────────┤
│ Feed Card  │                            │
│ + Tags     │                            │
├────────────┤    Article Grid            │
│ Trail Hist │                            │
│ [🏠]→[F]→[T]│                            │
│ ←scroll→   │                            │
└────────────┴────────────────────────────┘
```

### トレイル履歴カードのデザイン

```
┌──────────────────────────────────────┐
│  TRAIL HISTORY                       │
│  ┌───┐   ┌───┐   ┌───┐   ┌═══┐     │
│  │ 🏠│ → │ 📄│ → │ 🏷️│ → ║ 🏷️║     │
│  │Start│  │Feed│  │Tag1│  ║Tag2║    │
│  └───┘   └───┘   └───┘   └═══╝     │
│  ←─────── scroll ──────→           │
└──────────────────────────────────────┘

凡例:
- 🏠 Start (Home): 初期状態に戻る
- 📄 Feed: フィード起点
- 🏷️ Tag: タグホップ
- ═══ 現在位置（ハイライト表示）
```

## RESULTS, EFFECTS

### 変更ファイル

| ファイル | 変更内容 |
|---------|---------|
| `src/routes/desktop/feeds/tag-trail/+page.svelte` | `DesktopLayout`に`class="p-0"`を追加 |
| `src/lib/components/desktop/tag-trail/DesktopTagTrailScreen.svelte` | トレイル履歴UI追加、レイアウト調整 |

### 主要な実装

#### 1. レイアウトパディング制御

```svelte
<!-- +page.svelte -->
<DesktopLayout class="p-0">
  <DesktopTagTrailScreen initialFeed={data.initialFeed} />
</DesktopLayout>
```

```svelte
<!-- DesktopTagTrailScreen.svelte -->
<div class="flex flex-col h-full p-6">
  <!-- コンポーネント内部でパディングを管理 -->
</div>
```

#### 2. トレイル履歴セクション

```svelte
<!-- Trail History Section -->
{#if hops.length > 0}
  <div class="p-4 rounded-lg border bg-[var(--surface-bg)] border-[var(--surface-border)]">
    <h3 class="text-xs font-medium text-[var(--text-tertiary)] uppercase tracking-wide mb-3">
      Trail History
    </h3>
    <div class="overflow-x-auto scrollbar-thin">
      <div class="flex items-center gap-2 pb-2">
        <!-- Start (Home) Button -->
        <button onclick={() => handleHopClick(-1)} class="...">
          <div class="w-8 h-8 rounded-full bg-[var(--muted)] ...">
            <Home size={14} />
          </div>
          <span>Start</span>
        </button>

        {#each hops as hop, index}
          <ChevronRight size={14} />
          <!-- Hop Card with highlight for current position -->
          <button onclick={() => handleHopClick(index)} class="...">
            <!-- Icon based on hop type (Feed/Tag) -->
            <!-- Name with truncation -->
          </button>
        {/each}
      </div>
    </div>
  </div>
{/if}
```

#### 3. 左パネル構造変更

```svelte
<!-- Left Panel: Feed Card + Trail History -->
<aside class="w-80 flex-shrink-0 flex flex-col gap-4">
  <!-- Feed Card -->
  <div class="p-4 rounded-lg border ...">
    <!-- Feed info and tags -->
  </div>

  <!-- Trail History (conditional) -->
  {#if hops.length > 0}
    <div class="p-4 rounded-lg border ...">
      <!-- Trail history cards -->
    </div>
  {/if}
</aside>
```

### 視覚的特徴

| 要素 | スタイル |
|------|---------|
| 現在位置のホップ | `bg-opacity-10 ring-2 ring-[var(--alt-primary)]` |
| 現在位置のアイコン | `bg-[var(--alt-primary)] text-white` |
| 過去のホップ | `hover:bg-[var(--surface-hover)]` |
| 矢印 | `text-[var(--text-tertiary)]` |

### PROS

1. **視認性向上**: カード形式でトレイル履歴が一目で把握可能
2. **操作性向上**: 任意のホップにワンクリックで戻れる
3. **スペース効率**: 水平スクロールで長いトレイルにも対応
4. **レイアウト最適化**: 余計な空白を排除

### CONS, TRADEOFF

1. **画面幅消費**: 左パネルが2つのカードで高さを消費
2. **ブレッドクラム削除**: 上部ナビゲーションが消えた（トレイル履歴で代替）

## APPENDIX

### DesktopLayoutのclass prop活用

`DesktopLayout`は`cn()`ユーティリティを使用してクラスを合成するため、ページ単位でデフォルトスタイルを上書き可能:

```svelte
<!-- DesktopLayout.svelte -->
<main class={cn("flex-1 ml-60 p-6", className)}>
  {@render children()}
</main>
```

### 検証方法

1. `http://localhost:4173/sv/desktop/feeds/tag-trail` にアクセス
2. サイドバーとコンテンツ間の空白が解消されていることを確認
3. タグをクリックしてトレイルを作成
4. 左パネルにトレイル履歴カードが表示されることを確認
5. 水平スクロールで全履歴が閲覧可能か確認
6. 履歴カードクリックで該当ステップに戻れるか確認

### 関連ADR

- ADR-168: オンザフライタグ生成
- ADR-173: StreamArticleTags実装
- ADR-175: Tag Trail機能実装
