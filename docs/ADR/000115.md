# Recap Job Status ページのトリガーソース表示強化

## ADR'S STATUS

Accepted

## CONTEXT

### 背景

Recap Job Status ページ (`/sv/desktop/recap/job-status`) において、ジョブの実行元（システムバッチ/ユーザー手動）を識別できるようにする必要があった。

既存の状態:
1. **Start Job ボタン**: `hasRunningJob` によりジョブ実行中は無効化されていたが、ツールチップに実行元の情報がなかった
2. **ActiveJobCard**: ジョブ詳細に `trigger_source` データは存在していたが、UIに表示されていなかった
3. **JobHistoryTable**: 既に Source カラムで User/System を表示済み

### 要件

- ジョブ実行中に Start Job ボタンのツールチップで、システムジョブかユーザージョブかを識別できること
- Currently Running セクションで実行元を確認できること
- 一貫したアイコン使用（Server: システム、User: ユーザー）

## DECISION MAKING

### 決定

1. **ActiveJobCard にトリガーソース表示を追加**: メタ情報グリッドに「Source」フィールドを追加
2. **Start Job ボタンのツールチップ改善**: 実行中のジョブのトリガーソースを表示

### 設計

**ActiveJobCard のメタ情報グリッド拡張**:
- 既存: Started, Elapsed, Articles, Your Articles
- 追加: Source (Started と Elapsed の後)
- グリッドレイアウト: `grid-cols-2 sm:grid-cols-3 lg:grid-cols-5`

**ツールチップのロジック**:
```typescript
const runningJobTooltip = $derived(() => {
  const activeJob = jobProgress.data?.active_job;
  if (!activeJob) return "Start a new recap job";
  const source = activeJob.trigger_source === "user" ? "user" : "system";
  return `A ${source} job is already running`;
});
```

## RESULTS, EFFECTS

### 変更ファイル

| ファイル | 種別 | 内容 |
|----------|------|------|
| `alt-frontend-sv/src/lib/components/desktop/recap/job-status/ActiveJobCard.svelte` | 変更 | Server アイコン追加、Source メタ情報追加、グリッドレイアウト調整 |
| `alt-frontend-sv/src/routes/desktop/recap/job-status/+page.svelte` | 変更 | `runningJobTooltip` derived 追加、ボタンの title 属性更新 |

### UI変更

**ActiveJobCard**:
- Source フィールドが追加され、「System」または「User」と表示
- アイコン: System → Server、User → User（JobHistoryTable と同一パターン）

**Start Job ボタン**:
- ジョブ未実行時: "Start a new recap job"
- システムジョブ実行中: "A system job is already running"
- ユーザージョブ実行中: "A user job is already running"

### PROS

1. **一貫性**: JobHistoryTable と同じアイコン・表示パターンを使用
2. **可視性向上**: ジョブの実行元が一目でわかる
3. **UX改善**: なぜボタンが無効化されているか、より詳細な情報を提供

### CONS, TRADEOFF

1. **グリッドレイアウト変更**: 5カラムに拡張したため、小さい画面での表示確認が必要

## APPENDIX

### 検証結果

```bash
# 型チェック
bun run check
# svelte-check found 0 errors and 4 warnings in 3 files
# (警告は既存の別コンポーネントに関するもの)

# コンテナビルド・起動
docker compose -f compose/compose.yaml -p alt build alt-frontend-sv
docker compose -f compose/compose.yaml -p alt up -d alt-frontend-sv
# 正常起動確認済み
```

### 関連ADR

- ADR-109: Recap Job Status Dashboard 実装
- ADR-114: Recap Job ステータス履歴のイミュータブル化
