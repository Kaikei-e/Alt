# 要約・クラスタリング評価レポート

本ドキュメントは、Alt RSSリーダープラットフォームにおける記事要約とクラスタリング機能の評価結果をまとめたものです。

## 概要

システムは記事群をHDBSCANアルゴリズムでクラスタリングし、各クラスターからLLM（Gemma 3:4b）を用いて要約を生成します。

### 評価指標

| 指標 | 説明 |
|------|------|
| **カバレッジスコア** | 要約がクラスターの内容をどの程度網羅しているか（0-1） |
| **圧縮率** | 入力トークン数に対する出力トークン数の割合 |
| **シルエット係数** | クラスタリングの品質（0.1未満は分離が不明瞭） |
| **ノイズ比率** | ノイズとして分類された記事の割合 |

---

## システム構成

### 要約モデル

| パラメータ | 値 |
|-----------|------|
| モデル | `gemma3:4b` |
| Temperature | 0.55 - 0.70 |
| 平均圧縮率 | 23-25% |

### クラスタリング

| パラメータ | 設定範囲 |
|-----------|----------|
| アルゴリズム | HDBSCAN |
| 埋め込みモデル | `BAAI/bge-m3` |
| min_cluster_size | 5-20 |
| min_samples | 1-20 |
| UMAP | 有効 |

---

## 時系列推移サマリ

| フェーズ | 平均カバレッジ | 圧縮率 | 主な課題 |
|---------|---------------|--------|----------|
| Phase 1 | 0.4204 | 23.54% | 高ノイズ比率、低シルエット係数 |
| Phase 2 | 0.3852 | 24.69% | 分類用ジャンルの要約欠落 |
| Phase 3 | 0.2761 | 24.53% | 多数ジャンルで要約生成失敗 |

---

## 評価結果詳細

### Phase 1

**平均カバレッジスコア**: **0.4204**

#### 高評価ジャンル (Top 3)
| ジャンル | カバレッジ |
|----------|-----------|
| ai_data | 0.7701 |
| ai | 0.7411 |
| other | 0.7063 |

#### 低評価ジャンル (Bottom 3)
| ジャンル | カバレッジ | 備考 |
|----------|-----------|------|
| classification | 0.0000 | 要約なし |
| energy_transition | 0.0000 | クラスタあり、要約なし |

#### システムパフォーマンス

**要約処理**:
- 圧縮率: 23.54%（入力 20,709 → 出力 4,874 トークン）
- 平均処理時間: 7.81秒/件

**クラスタリング**:
- 平均処理時間: 5.58秒/件
- 警告: 6件でノイズ比率 > 50%
- 警告: 25件でシルエット係数 < 0.1

---

### Phase 2

**平均カバレッジスコア**: **0.3852**

#### 全体統計
| 指標 | 値 |
|------|------|
| 総ジャンル数 | 39 |
| 総生成箇条書き数 | 77 |
| 総クラスタ数 | 107 |

#### 高評価ジャンル (Top 3)
| ジャンル | カバレッジ |
|----------|-----------|
| ai_data | 0.7651 |
| markets_finance | 0.7360 |
| tech | 0.7297 |

#### 要約欠落ジャンル

以下のジャンルではクラスタリングは成功したが要約が生成されなかった:

| ジャンル | クラスタ数 | 最大入力文字数 |
|----------|-----------|---------------|
| product_001 | 4 | 487 |
| energy_transition | 3 | 370 |
| tech_009 | 3 | 207 |

---

### Phase 3

**平均カバレッジスコア**: **0.2761**

#### 全体統計
| 指標 | 値 |
|------|------|
| 総ジャンル数 | 46 |
| 総生成箇条書き数 | 53 |
| 総クラスタ数 | 111 |

#### 高評価ジャンル (Top 3)
| ジャンル | カバレッジ |
|----------|-----------|
| tech_008 | 0.7905 |
| tech_006 | 0.7739 |
| other.0 | 0.7431 |

#### 要約欠落ジャンル（抜粋）

| ジャンル | クラスタ数 | 最大サイズ | 最大入力文字数 |
|----------|-----------|-----------|---------------|
| tech | 6 | 136 | 667 |
| tech_005 | 3 | 52 | 240 |
| tech_002 | 4 | 87 | 256 |
| ai_data | 4 | 79 | 137 |

---

## 課題分析

### 1. 高ノイズ比率

多くのクラスタリング処理でノイズ比率が50%を超えている。

**原因**:
- `min_cluster_size` の設定が厳しすぎる
- 記事の内容が多様すぎてクラスターが形成されない

**対策**:
- `min_cluster_size` のジャンル別調整
- フォールバック処理の改善

### 2. 低シルエット係数

シルエット係数が0.1未満のケースが多い（クラスタの分離が不明瞭）。

**原因**:
- 埋め込みモデルがジャンル固有の語彙を十分に捉えていない
- 記事間の意味的距離が小さい

**対策**:
- 埋め込みモデルの再検討（`intfloat/multilingual-e5-large` など）
- HDBSCAN パラメータの最適化

### 3. 要約生成の失敗

クラスタリングは成功しても要約が生成されないケースがある。

**原因**:
- LLMのコンテキストウィンドウ超過
- タイムアウト
- 入力文字数が多すぎる

**対策**:
- 入力トークン数の事前チェック
- 再帰的クラスタリング（大規模クラスターの分割）

---

## 推奨アクション

### 短期
1. **ノイズ対策**: HDBSCANパラメータの動的調整
2. **入力サイズ制限**: クラスターごとのトークン数上限設定

### 中期
1. **埋め込みモデル改善**: 多言語対応モデルの比較評価
2. **プロンプト最適化**: 「具体的な事実を含める」指示の強化

### 長期
1. **クラスタリング品質の監視ダッシュボード**
2. **ジャンル別パラメータの自動チューニング**

---

## ジャンル別詳細データ（Phase 1）

| ジャンル | 要約数 | クラスタ数 | カバレッジ | 最大入力文字数 |
|----------|--------|-----------|-----------|---------------|
| tech | 5 | 7 | 0.6614 | 673 |
| culture_arts | 3 | 4 | 0.4927 | 248 |
| film_tv | 5 | 7 | 0.5027 | 210 |
| other.4 | 3 | 5 | 0.6093 | 243 |
| society_demographics | 5 | 8 | 0.6330 | 382 |
| product | 5 | 11 | 0.6842 | 688 |
| other | 5 | 9 | 0.7063 | 205 |
| life_science | 4 | 3 | 0.5281 | 2040 |
| cybersecurity | 5 | 4 | 0.4882 | 351 |
| software_dev | 3 | 4 | 0.6152 | 1022 |
| markets_finance | 2 | 3 | 0.6378 | 250 |
| other.1 | 3 | 3 | 0.4934 | 176 |
| other.3 | 2 | 3 | 0.6797 | 105 |
| pro_it_media | 3 | 2 | 0.5420 | 203 |
| ai_data | 4 | 4 | 0.7701 | 137 |
| consumer_tech | 3 | 3 | 0.5483 | 258 |
| home_living | 3 | 3 | 0.5975 | 151 |
| ai | 2 | 3 | 0.7411 | 161 |
