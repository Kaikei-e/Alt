# 評価手法ドキュメント

本ドキュメントは、Alt RSSリーダープラットフォームの各機能評価で使用されているモデル、データセット、メトリクスについて説明します。

## 使用モデル

### 埋め込みモデル

| モデル名 | 用途 | 備考 |
|---------|------|------|
| `BAAI/bge-m3` | クラスタリング、類似度計算 | 多言語対応、現行主力モデル |
| `intfloat/multilingual-e5-large` | 代替候補 | シルエット係数改善のための検討対象 |

**特徴**:
- Sentence-Transformers バックエンドで動作
- 多言語（日本語・英語）に対応
- 記事のベクトル化に使用

### 要約モデル

| モデル名 | パラメータ | 用途 |
|---------|-----------|------|
| `gemma3:4b` (Gemma 3 4B) | 4B パラメータ | 記事クラスターの要約生成 |

**設定**:
- Temperature: 0.55 - 0.70
- Ollama ランタイムで実行

### ジャンル分類モデル

| 構成 | 説明 |
|------|------|
| Dual Model (JA/EN) | 日本語・英語それぞれに最適化されたモデル |
| ベース | `BAAI/bge-m3` をベースとした埋め込み + 分類ヘッド |

---

## 評価データセット

### Golden Classification Dataset

ジャンル分類モデルの評価に使用する正解データセット。

| 属性 | 値 |
|------|------|
| サンプル数（日本語） | 960 |
| サンプル数（英語） | 960 |
| ジャンル数 | 30 |
| 各ジャンルあたりのサンプル数 | 約32（均等分布） |

**作成方法**:
- 人手によるアノテーション
- マルチラベル対応（1記事に複数ジャンル付与可能）

---

## 評価メトリクス

### カバレッジスコア

要約の品質を測定する指標。

**定義**:
生成された要約（箇条書き）が、元のクラスターの代表的な文章（セントロイド）の内容をどの程度カバーしているか。

**計算方法**:
1. クラスターのセントロイドを埋め込みベクトル化
2. 生成された要約を埋め込みベクトル化
3. コサイン類似度を計算
4. ジャンル内クラスターの平均を算出

**解釈**:
- 0.7 以上: 高品質
- 0.5 - 0.7: 許容範囲
- 0.5 未満: 改善が必要

### クラスタリングメトリクス

#### シルエット係数 (Silhouette Score)

クラスタリングの品質を測定。

| 範囲 | 解釈 |
|------|------|
| 0.7 - 1.0 | 強い構造 |
| 0.5 - 0.7 | 合理的な構造 |
| 0.25 - 0.5 | 弱い構造 |
| 0.1 未満 | 分離が不明瞭（警告） |

#### ノイズ比率 (Noise Ratio)

HDBSCANでノイズ（クラスタに属さない）と分類されたサンプルの割合。

| 範囲 | 解釈 |
|------|------|
| 0.3 未満 | 良好 |
| 0.3 - 0.5 | 許容範囲 |
| 0.5 以上 | 警告（パラメータ調整が必要） |

### 分類メトリクス

#### Top-1 評価

単一ラベル分類タスクとしての評価。最も確信度の高いジャンルのみで判定。

- **Accuracy**: 正解率
- **Precision**: 適合率（予測の正確さ）
- **Recall**: 再現率（正解の網羅度）
- **F1**: Precision と Recall の調和平均

#### Strict マルチラベル評価

閾値0.5を用いたマルチラベル分類の評価。

- **Exact Match Ratio**: 全ての正解ラベルと完全に一致した割合
- **Macro F1**: クラス間平均 F1（各ジャンルを均等に重み付け）
- **Micro F1**: 全体での F1（サンプル数で重み付け）

#### 信頼区間

95%信頼区間を Wilson 法で計算。サンプルサイズに基づく推定の不確実性を表示。

---

## HDBSCANパラメータ

クラスタリングアルゴリズムの設定。

| パラメータ | 設定範囲 | 説明 |
|-----------|----------|------|
| `min_cluster_size` | 5-20 | 最小クラスターサイズ |
| `min_samples` | 1-20 | コアポイント判定のための最小サンプル数 |
| `umap_used` | true | 次元削減の有無 |

**調整指針**:
- ノイズ比率が高い場合: `min_cluster_size` を下げる
- クラスター数が多すぎる場合: `min_cluster_size` を上げる

---

## 処理パイプライン

### Recapジョブフロー

```
記事取得 → クラスタリング → 要約生成 → 保存
              ↓                    ↓
         [recap-subworker]   [news-creator]
              ↓                    ↓
         クラスター情報      要約文 (bullets)
```

### 分類フロー

```
記事テキスト → 埋め込み → 分類モデル → ジャンルスコア → 閾値判定
                  ↓
            [bge-m3 embedder]
```

---

## 評価レポートの読み方

### レポート構成

1. **エグゼクティブサマリ**: 主要な結論
2. **基本メトリクス**: Accuracy, F1 等の数値
3. **ジャンル別パフォーマンス**: 各ジャンルの詳細
4. **課題分析**: 問題点の特定
5. **推奨アクション**: 改善提案

### 注意点

- **Top-1** と **Strict** の乖離が大きい場合、マルチラベル設定の閾値調整が必要
- **高Precision・低Recall** の場合、該当ジャンルのスコアが全体的に低く出ている
- **F1 = 0** の場合、ほぼ検出できていない（閾値が厳しすぎる可能性）
