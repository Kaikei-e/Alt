apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "csr-controller.fullname" . }}-compliance-automation
  namespace: {{ .Release.Namespace }}
  labels:
    {{- include "csr-controller.labels" . | nindent 4 }}
    app.kubernetes.io/component: compliance-automation
spec:
  replicas: {{ .Values.complianceAutomation.replicas | default 1 }}
  selector:
    matchLabels:
      {{- include "csr-controller.selectorLabels" . | nindent 6 }}
      app.kubernetes.io/component: compliance-automation
  template:
    metadata:
      annotations:
        {{- with .Values.podAnnotations }}
        {{- toYaml . | nindent 8 }}
        {{- end }}
        prometheus.io/scrape: "true"
        prometheus.io/port: "8080"
        prometheus.io/path: "/metrics"
      labels:
        {{- include "csr-controller.selectorLabels" . | nindent 8 }}
        app.kubernetes.io/component: compliance-automation
    spec:
      {{- with .Values.imagePullSecrets }}
      imagePullSecrets:
        {{- toYaml . | nindent 8 }}
      {{- end }}
      serviceAccountName: {{ include "csr-controller.serviceAccountName" . }}
      securityContext:
        {{- toYaml .Values.podSecurityContext | nindent 8 }}
      containers:
      - name: compliance-automation
        securityContext:
          {{- toYaml .Values.securityContext | nindent 12 }}
        image: "{{ .Values.complianceAutomation.image.repository }}:{{ .Values.complianceAutomation.image.tag | default .Chart.AppVersion }}"
        imagePullPolicy: {{ .Values.complianceAutomation.image.pullPolicy }}
        env:
        - name: COMPLIANCE_STANDARDS
          value: {{ .Values.complianceAutomation.standards | join "," | quote }}
        - name: AUTOMATED_REMEDIATION_ENABLED
          value: {{ .Values.complianceAutomation.automatedRemediation.enabled | default true | quote }}
        - name: CONTINUOUS_MONITORING_ENABLED
          value: {{ .Values.complianceAutomation.continuousMonitoring.enabled | default true | quote }}
        - name: COMPLIANCE_DASHBOARD_ENABLED
          value: {{ .Values.complianceAutomation.dashboard.enabled | default true | quote }}
        - name: EVIDENCE_COLLECTION_ENABLED
          value: {{ .Values.complianceAutomation.evidenceCollection.enabled | default true | quote }}
        - name: AUDIT_INTEGRATION_ENABLED
          value: {{ .Values.complianceAutomation.auditIntegration.enabled | default true | quote }}
        - name: REPORTING_SCHEDULE
          value: {{ .Values.complianceAutomation.reporting.schedule | default "0 8 * * 1" | quote }}
        - name: RISK_ASSESSMENT_ENABLED
          value: {{ .Values.complianceAutomation.riskAssessment.enabled | default true | quote }}
        ports:
        - name: http
          containerPort: 8080
          protocol: TCP
        - name: grpc
          containerPort: 9090
          protocol: TCP
        - name: dashboard
          containerPort: 3000
          protocol: TCP
        livenessProbe:
          httpGet:
            path: /healthz
            port: http
          initialDelaySeconds: 30
          periodSeconds: 10
        readinessProbe:
          httpGet:
            path: /ready
            port: http
          initialDelaySeconds: 5
          periodSeconds: 5
        resources:
          {{- toYaml .Values.complianceAutomation.resources | nindent 12 }}
        volumeMounts:
        - name: compliance-config
          mountPath: /etc/compliance
          readOnly: true
        - name: compliance-policies
          mountPath: /etc/compliance-policies
          readOnly: true
        - name: evidence-storage
          mountPath: /var/lib/compliance/evidence
        - name: reports-storage
          mountPath: /var/lib/compliance/reports
        - name: audit-logs
          mountPath: /var/log/compliance
        - name: assessment-data
          mountPath: /var/lib/compliance/assessments
      volumes:
      - name: compliance-config
        configMap:
          name: {{ include "csr-controller.fullname" . }}-compliance-automation-config
      - name: compliance-policies
        configMap:
          name: {{ include "csr-controller.fullname" . }}-compliance-policies
      - name: evidence-storage
        persistentVolumeClaim:
          claimName: {{ include "csr-controller.fullname" . }}-compliance-evidence
      - name: reports-storage
        persistentVolumeClaim:
          claimName: {{ include "csr-controller.fullname" . }}-compliance-reports
      - name: audit-logs
        persistentVolumeClaim:
          claimName: {{ include "csr-controller.fullname" . }}-compliance-audit-logs
      - name: assessment-data
        persistentVolumeClaim:
          claimName: {{ include "csr-controller.fullname" . }}-compliance-assessments
      {{- with .Values.nodeSelector }}
      nodeSelector:
        {{- toYaml . | nindent 8 }}
      {{- end }}
      {{- with .Values.affinity }}
      affinity:
        {{- toYaml . | nindent 8 }}
      {{- end }}
      {{- with .Values.tolerations }}
      tolerations:
        {{- toYaml . | nindent 8 }}
      {{- end }}
---
apiVersion: batch/v1
kind: CronJob
metadata:
  name: {{ include "csr-controller.fullname" . }}-compliance-assessment
  namespace: {{ .Release.Namespace }}
  labels:
    {{- include "csr-controller.labels" . | nindent 4 }}
    app.kubernetes.io/component: compliance-automation
spec:
  schedule: {{ .Values.complianceAutomation.assessment.schedule | default "0 6 * * 1" | quote }}
  jobTemplate:
    spec:
      template:
        spec:
          restartPolicy: OnFailure
          serviceAccountName: {{ include "csr-controller.serviceAccountName" . }}
          containers:
          - name: compliance-assessment
            image: "{{ .Values.complianceAutomation.image.repository }}:{{ .Values.complianceAutomation.image.tag | default .Chart.AppVersion }}"
            imagePullPolicy: {{ .Values.complianceAutomation.image.pullPolicy }}
            command:
            - /bin/sh
            - -c
            - |
              echo "Starting compliance assessment..."
              
              # Run compliance assessment for each standard
              for standard in $(echo $COMPLIANCE_STANDARDS | tr ',' ' '); do
                echo "Assessing compliance for standard: $standard"
                /usr/local/bin/compliance-assessor --standard=$standard --output=/var/lib/compliance/assessments/
              done
              
              # Generate consolidated report
              echo "Generating consolidated compliance report..."
              /usr/local/bin/compliance-reporter --input=/var/lib/compliance/assessments/ --output=/var/lib/compliance/reports/
              
              # Send notifications
              echo "Sending compliance notifications..."
              /usr/local/bin/compliance-notifier --report=/var/lib/compliance/reports/latest.json
              
              echo "Compliance assessment completed successfully"
            env:
            - name: COMPLIANCE_STANDARDS
              value: {{ .Values.complianceAutomation.standards | join "," | quote }}
            - name: ASSESSMENT_DEPTH
              value: {{ .Values.complianceAutomation.assessment.depth | default "comprehensive" | quote }}
            - name: NOTIFICATION_ENABLED
              value: {{ .Values.complianceAutomation.assessment.notifications.enabled | default true | quote }}
            volumeMounts:
            - name: compliance-config
              mountPath: /etc/compliance
              readOnly: true
            - name: evidence-storage
              mountPath: /var/lib/compliance/evidence
            - name: reports-storage
              mountPath: /var/lib/compliance/reports
            - name: assessment-data
              mountPath: /var/lib/compliance/assessments
          volumes:
          - name: compliance-config
            configMap:
              name: {{ include "csr-controller.fullname" . }}-compliance-automation-config
          - name: evidence-storage
            persistentVolumeClaim:
              claimName: {{ include "csr-controller.fullname" . }}-compliance-evidence
          - name: reports-storage
            persistentVolumeClaim:
              claimName: {{ include "csr-controller.fullname" . }}-compliance-reports
          - name: assessment-data
            persistentVolumeClaim:
              claimName: {{ include "csr-controller.fullname" . }}-compliance-assessments
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "csr-controller.fullname" . }}-compliance-automation-config
  namespace: {{ .Release.Namespace }}
  labels:
    {{- include "csr-controller.labels" . | nindent 4 }}
    app.kubernetes.io/component: compliance-automation
data:
  compliance-automation.yaml: |
    # Compliance Automation Configuration
    version: "1.0"
    
    # Global Configuration
    global:
      organization: {{ .Values.complianceAutomation.organization | default "Alt RSS Reader" | quote }}
      environment: {{ .Values.complianceAutomation.environment | default "production" | quote }}
      reporting_timezone: {{ .Values.complianceAutomation.reportingTimezone | default "UTC" | quote }}
      
    # Compliance Standards Configuration
    standards:
      {{- range .Values.complianceAutomation.standards }}
      - name: {{ . | quote }}
        enabled: true
        {{- if eq . "SOC2" }}
        version: "2017"
        trust_services:
          - "security"
          - "availability"
          - "processing_integrity"
          - "confidentiality"
        {{- else if eq . "PCI_DSS" }}
        version: "4.0"
        scope: "certificate_management"
        {{- else if eq . "ISO_27001" }}
        version: "2022"
        scope: "information_security_management"
        {{- else if eq . "NIST_CSF" }}
        version: "1.1"
        functions:
          - "identify"
          - "protect"
          - "detect"
          - "respond"
          - "recover"
        {{- else if eq . "FIPS_140_2" }}
        level: "Level 2"
        scope: "cryptographic_module"
        {{- end }}
      {{- end }}
    
    # Automated Remediation Configuration
    automated_remediation:
      enabled: {{ .Values.complianceAutomation.automatedRemediation.enabled | default true }}
      
      # Remediation Policies
      policies:
        # Configuration Drift Remediation
        - name: "config_drift_remediation"
          enabled: {{ .Values.complianceAutomation.automatedRemediation.policies.configDrift.enabled | default true }}
          triggers:
            - "configuration_changed"
            - "policy_violation"
          actions:
            - "revert_configuration"
            - "apply_baseline"
            - "notify_administrators"
          
        # Security Control Remediation
        - name: "security_control_remediation"
          enabled: {{ .Values.complianceAutomation.automatedRemediation.policies.securityControl.enabled | default true }}
          triggers:
            - "control_failure"
            - "vulnerability_detected"
          actions:
            - "apply_security_patch"
            - "update_configuration"
            - "quarantine_resource"
            - "escalate_incident"
          
        # Access Control Remediation
        - name: "access_control_remediation"
          enabled: {{ .Values.complianceAutomation.automatedRemediation.policies.accessControl.enabled | default true }}
          triggers:
            - "unauthorized_access"
            - "privilege_escalation"
          actions:
            - "revoke_access"
            - "reset_permissions"
            - "require_re_authentication"
            - "audit_access_logs"
          
        # Certificate Management Remediation
        - name: "certificate_remediation"
          enabled: {{ .Values.complianceAutomation.automatedRemediation.policies.certificate.enabled | default true }}
          triggers:
            - "certificate_expiring"
            - "certificate_invalid"
            - "weak_cryptography"
          actions:
            - "renew_certificate"
            - "update_cipher_suite"
            - "revoke_compromised_cert"
            - "notify_stakeholders"
      
      # Remediation Limits
      limits:
        max_actions_per_hour: {{ .Values.complianceAutomation.automatedRemediation.limits.maxActionsPerHour | default 10 }}
        max_actions_per_day: {{ .Values.complianceAutomation.automatedRemediation.limits.maxActionsPerDay | default 100 }}
        critical_actions_approval_required: {{ .Values.complianceAutomation.automatedRemediation.limits.criticalActionsApprovalRequired | default true }}
        
      # Approval Workflows
      approval_workflows:
        - name: "critical_remediation_approval"
          enabled: {{ .Values.complianceAutomation.automatedRemediation.approvalWorkflows.criticalRemediation.enabled | default true }}
          triggers:
            - "production_system_changes"
            - "security_control_modifications"
          approvers:
            - "security-team@alt.production.local"
            - "compliance-officer@alt.production.local"
          approval_timeout: {{ .Values.complianceAutomation.automatedRemediation.approvalWorkflows.criticalRemediation.approvalTimeout | default "4h" | quote }}
    
    # Continuous Monitoring Configuration
    continuous_monitoring:
      enabled: {{ .Values.complianceAutomation.continuousMonitoring.enabled | default true }}
      
      # Monitoring Intervals
      intervals:
        security_controls: {{ .Values.complianceAutomation.continuousMonitoring.intervals.securityControls | default "5m" | quote }}
        configuration_compliance: {{ .Values.complianceAutomation.continuousMonitoring.intervals.configurationCompliance | default "15m" | quote }}
        access_controls: {{ .Values.complianceAutomation.continuousMonitoring.intervals.accessControls | default "1h" | quote }}
        certificate_compliance: {{ .Values.complianceAutomation.continuousMonitoring.intervals.certificateCompliance | default "30m" | quote }}
        policy_compliance: {{ .Values.complianceAutomation.continuousMonitoring.intervals.policyCompliance | default "1h" | quote }}
      
      # Monitoring Scopes
      scopes:
        - name: "infrastructure_monitoring"
          enabled: {{ .Values.complianceAutomation.continuousMonitoring.scopes.infrastructure.enabled | default true }}
          targets:
            - "kubernetes_cluster"
            - "network_configuration"
            - "storage_encryption"
            - "backup_systems"
          
        - name: "application_monitoring"
          enabled: {{ .Values.complianceAutomation.continuousMonitoring.scopes.application.enabled | default true }}
          targets:
            - "csr_controller"
            - "certificate_management"
            - "authentication_systems"
            - "audit_logging"
          
        - name: "data_monitoring"
          enabled: {{ .Values.complianceAutomation.continuousMonitoring.scopes.data.enabled | default true }}
          targets:
            - "data_classification"
            - "data_encryption"
            - "data_retention"
            - "data_access_controls"
      
      # Alerting Configuration
      alerting:
        enabled: {{ .Values.complianceAutomation.continuousMonitoring.alerting.enabled | default true }}
        
        # Alert Channels
        channels:
          - name: "slack"
            enabled: {{ .Values.complianceAutomation.continuousMonitoring.alerting.channels.slack.enabled | default true }}
            webhook_url: {{ .Values.complianceAutomation.continuousMonitoring.alerting.channels.slack.webhookUrl | default "" | quote }}
            channel: {{ .Values.complianceAutomation.continuousMonitoring.alerting.channels.slack.channel | default "#compliance-alerts" | quote }}
          
          - name: "email"
            enabled: {{ .Values.complianceAutomation.continuousMonitoring.alerting.channels.email.enabled | default true }}
            recipients:
              - "compliance-team@alt.production.local"
              - "security-team@alt.production.local"
          
          - name: "webhook"
            enabled: {{ .Values.complianceAutomation.continuousMonitoring.alerting.channels.webhook.enabled | default false }}
            endpoint: {{ .Values.complianceAutomation.continuousMonitoring.alerting.channels.webhook.endpoint | default "" | quote }}
        
        # Alert Rules
        rules:
          - name: "compliance_violation_detected"
            condition: "compliance_violation_count > 0"
            severity: "high"
            description: "Compliance violation detected"
            
          - name: "security_control_failure"
            condition: "security_control_status == 'failed'"
            severity: "critical"
            description: "Security control failure detected"
            
          - name: "configuration_drift"
            condition: "configuration_compliance_score < 0.9"
            severity: "medium"
            description: "Configuration drift detected"
            
          - name: "certificate_compliance_issue"
            condition: "certificate_compliance_score < 0.95"
            severity: "medium"
            description: "Certificate compliance issue detected"
    
    # Evidence Collection Configuration
    evidence_collection:
      enabled: {{ .Values.complianceAutomation.evidenceCollection.enabled | default true }}
      
      # Collection Strategies
      strategies:
        - name: "automated_screenshot"
          enabled: {{ .Values.complianceAutomation.evidenceCollection.strategies.automatedScreenshot.enabled | default true }}
          frequency: {{ .Values.complianceAutomation.evidenceCollection.strategies.automatedScreenshot.frequency | default "daily" | quote }}
          
        - name: "configuration_snapshot"
          enabled: {{ .Values.complianceAutomation.evidenceCollection.strategies.configurationSnapshot.enabled | default true }}
          frequency: {{ .Values.complianceAutomation.evidenceCollection.strategies.configurationSnapshot.frequency | default "hourly" | quote }}
          
        - name: "audit_log_collection"
          enabled: {{ .Values.complianceAutomation.evidenceCollection.strategies.auditLogCollection.enabled | default true }}
          frequency: {{ .Values.complianceAutomation.evidenceCollection.strategies.auditLogCollection.frequency | default "continuous" | quote }}
          
        - name: "security_scan_results"
          enabled: {{ .Values.complianceAutomation.evidenceCollection.strategies.securityScanResults.enabled | default true }}
          frequency: {{ .Values.complianceAutomation.evidenceCollection.strategies.securityScanResults.frequency | default "weekly" | quote }}
      
      # Evidence Storage
      storage:
        encryption: {{ .Values.complianceAutomation.evidenceCollection.storage.encryption | default true }}
        retention_period: {{ .Values.complianceAutomation.evidenceCollection.storage.retentionPeriod | default "7y" | quote }}
        backup_enabled: {{ .Values.complianceAutomation.evidenceCollection.storage.backupEnabled | default true }}
        integrity_verification: {{ .Values.complianceAutomation.evidenceCollection.storage.integrityVerification | default true }}
        
      # Evidence Types
      types:
        - name: "system_configurations"
          description: "System and application configurations"
          collection_method: "api_snapshot"
          
        - name: "security_policies"
          description: "Security policies and procedures"
          collection_method: "document_capture"
          
        - name: "access_controls"
          description: "Access control configurations and logs"
          collection_method: "log_aggregation"
          
        - name: "audit_trails"
          description: "Audit trails and security events"
          collection_method: "log_streaming"
          
        - name: "vulnerability_scans"
          description: "Vulnerability assessment results"
          collection_method: "scan_integration"
          
        - name: "penetration_tests"
          description: "Penetration testing results"
          collection_method: "report_import"
    
    # Risk Assessment Configuration
    risk_assessment:
      enabled: {{ .Values.complianceAutomation.riskAssessment.enabled | default true }}
      
      # Assessment Framework
      framework: {{ .Values.complianceAutomation.riskAssessment.framework | default "nist_800_30" | quote }}
      
      # Risk Categories
      categories:
        - name: "security_risks"
          weight: {{ .Values.complianceAutomation.riskAssessment.categories.securityRisks.weight | default 0.4 }}
          
        - name: "compliance_risks"
          weight: {{ .Values.complianceAutomation.riskAssessment.categories.complianceRisks.weight | default 0.3 }}
          
        - name: "operational_risks"
          weight: {{ .Values.complianceAutomation.riskAssessment.categories.operationalRisks.weight | default 0.2 }}
          
        - name: "business_risks"
          weight: {{ .Values.complianceAutomation.riskAssessment.categories.businessRisks.weight | default 0.1 }}
      
      # Risk Scoring
      scoring:
        method: {{ .Values.complianceAutomation.riskAssessment.scoring.method | default "cvss_based" | quote }}
        
        # Risk Levels
        levels:
          low: {{ .Values.complianceAutomation.riskAssessment.scoring.levels.low | default "0.0-3.9" | quote }}
          medium: {{ .Values.complianceAutomation.riskAssessment.scoring.levels.medium | default "4.0-6.9" | quote }}
          high: {{ .Values.complianceAutomation.riskAssessment.scoring.levels.high | default "7.0-8.9" | quote }}
          critical: {{ .Values.complianceAutomation.riskAssessment.scoring.levels.critical | default "9.0-10.0" | quote }}
      
      # Automated Risk Identification
      automated_identification:
        enabled: {{ .Values.complianceAutomation.riskAssessment.automatedIdentification.enabled | default true }}
        
        # Risk Sources
        sources:
          - "vulnerability_scanners"
          - "security_controls"
          - "configuration_audits"
          - "threat_intelligence"
          - "incident_reports"
        
        # Risk Analysis
        analysis:
          impact_assessment: {{ .Values.complianceAutomation.riskAssessment.automatedIdentification.analysis.impactAssessment | default true }}
          likelihood_assessment: {{ .Values.complianceAutomation.riskAssessment.automatedIdentification.analysis.likelihoodAssessment | default true }}
          threat_modeling: {{ .Values.complianceAutomation.riskAssessment.automatedIdentification.analysis.threatModeling | default true }}
          business_impact_analysis: {{ .Values.complianceAutomation.riskAssessment.automatedIdentification.analysis.businessImpactAnalysis | default true }}
      
      # Risk Treatment
      treatment:
        strategies:
          - name: "accept"
            description: "Accept the risk"
            criteria: "risk_score < 2.0"
            
          - name: "mitigate"
            description: "Implement controls to reduce risk"
            criteria: "risk_score >= 2.0 and risk_score < 8.0"
            
          - name: "transfer"
            description: "Transfer risk to third party"
            criteria: "risk_score >= 8.0 and transferable == true"
            
          - name: "avoid"
            description: "Avoid the risk entirely"
            criteria: "risk_score >= 9.0"
        
        # Automated Treatment
        automated_treatment:
          enabled: {{ .Values.complianceAutomation.riskAssessment.treatment.automatedTreatment.enabled | default true }}
          
          # Treatment Actions
          actions:
            - trigger: "high_risk_detected"
              actions:
                - "create_incident"
                - "notify_risk_team"
                - "implement_controls"
                - "schedule_assessment"
            
            - trigger: "critical_risk_detected"
              actions:
                - "create_emergency_incident"
                - "notify_executives"
                - "implement_emergency_controls"
                - "schedule_immediate_assessment"
    
    # Reporting Configuration
    reporting:
      enabled: {{ .Values.complianceAutomation.reporting.enabled | default true }}
      
      # Report Types
      types:
        - name: "compliance_status_report"
          enabled: {{ .Values.complianceAutomation.reporting.types.complianceStatusReport.enabled | default true }}
          frequency: {{ .Values.complianceAutomation.reporting.types.complianceStatusReport.frequency | default "weekly" | quote }}
          recipients:
            - "compliance-team@alt.production.local"
            - "management@alt.production.local"
          
        - name: "security_control_report"
          enabled: {{ .Values.complianceAutomation.reporting.types.securityControlReport.enabled | default true }}
          frequency: {{ .Values.complianceAutomation.reporting.types.securityControlReport.frequency | default "monthly" | quote }}
          recipients:
            - "security-team@alt.production.local"
            - "compliance-team@alt.production.local"
          
        - name: "risk_assessment_report"
          enabled: {{ .Values.complianceAutomation.reporting.types.riskAssessmentReport.enabled | default true }}
          frequency: {{ .Values.complianceAutomation.reporting.types.riskAssessmentReport.frequency | default "quarterly" | quote }}
          recipients:
            - "risk-team@alt.production.local"
            - "executives@alt.production.local"
          
        - name: "audit_readiness_report"
          enabled: {{ .Values.complianceAutomation.reporting.types.auditReadinessReport.enabled | default true }}
          frequency: {{ .Values.complianceAutomation.reporting.types.auditReadinessReport.frequency | default "quarterly" | quote }}
          recipients:
            - "audit-team@alt.production.local"
            - "compliance-officer@alt.production.local"
          
        - name: "executive_dashboard"
          enabled: {{ .Values.complianceAutomation.reporting.types.executiveDashboard.enabled | default true }}
          frequency: {{ .Values.complianceAutomation.reporting.types.executiveDashboard.frequency | default "monthly" | quote }}
          recipients:
            - "executives@alt.production.local"
            - "board@alt.production.local"
      
      # Report Formats
      formats:
        - "pdf"
        - "html"
        - "json"
        - "csv"
        - "xlsx"
      
      # Report Delivery
      delivery:
        methods:
          - "email"
          - "slack"
          - "webhook"
          - "file_share"
        
        # Report Storage
        storage:
          retention_period: {{ .Values.complianceAutomation.reporting.delivery.storage.retentionPeriod | default "5y" | quote }}
          encryption: {{ .Values.complianceAutomation.reporting.delivery.storage.encryption | default true }}
          backup: {{ .Values.complianceAutomation.reporting.delivery.storage.backup | default true }}
    
    # Integration Configuration
    integration:
      # External Compliance Systems
      external_systems:
        # GRC Platforms
        grc_platforms:
          - name: "rsam"
            enabled: {{ .Values.complianceAutomation.integration.grcPlatforms.rsam.enabled | default false }}
            api_endpoint: {{ .Values.complianceAutomation.integration.grcPlatforms.rsam.apiEndpoint | default "" | quote }}
            
          - name: "servicenow_grc"
            enabled: {{ .Values.complianceAutomation.integration.grcPlatforms.servicenowGrc.enabled | default false }}
            api_endpoint: {{ .Values.complianceAutomation.integration.grcPlatforms.servicenowGrc.apiEndpoint | default "" | quote }}
            
          - name: "archer"
            enabled: {{ .Values.complianceAutomation.integration.grcPlatforms.archer.enabled | default false }}
            api_endpoint: {{ .Values.complianceAutomation.integration.grcPlatforms.archer.apiEndpoint | default "" | quote }}
        
        # Audit Systems
        audit_systems:
          - name: "splunk"
            enabled: {{ .Values.complianceAutomation.integration.auditSystems.splunk.enabled | default true }}
            api_endpoint: {{ .Values.complianceAutomation.integration.auditSystems.splunk.apiEndpoint | default "https://splunk.alt.production.local:8089" | quote }}
            
          - name: "elasticsearch"
            enabled: {{ .Values.complianceAutomation.integration.auditSystems.elasticsearch.enabled | default true }}
            api_endpoint: {{ .Values.complianceAutomation.integration.auditSystems.elasticsearch.apiEndpoint | default "https://elasticsearch.alt.production.local:9200" | quote }}
        
        # Vulnerability Management
        vulnerability_management:
          - name: "qualys"
            enabled: {{ .Values.complianceAutomation.integration.vulnerabilityManagement.qualys.enabled | default false }}
            api_endpoint: {{ .Values.complianceAutomation.integration.vulnerabilityManagement.qualys.apiEndpoint | default "" | quote }}
            
          - name: "nessus"
            enabled: {{ .Values.complianceAutomation.integration.vulnerabilityManagement.nessus.enabled | default false }}
            api_endpoint: {{ .Values.complianceAutomation.integration.vulnerabilityManagement.nessus.apiEndpoint | default "" | quote }}
      
      # Internal System Integration
      internal_systems:
        # CSR Controller Integration
        csr_controller:
          enabled: {{ .Values.complianceAutomation.integration.internalSystems.csrController.enabled | default true }}
          endpoint: {{ .Values.complianceAutomation.integration.internalSystems.csrController.endpoint | default "http://csr-controller:8080" | quote }}
          
        # Security Policy Engine Integration
        security_policy_engine:
          enabled: {{ .Values.complianceAutomation.integration.internalSystems.securityPolicyEngine.enabled | default true }}
          endpoint: {{ .Values.complianceAutomation.integration.internalSystems.securityPolicyEngine.endpoint | default "http://security-policy-engine:8080" | quote }}
          
        # Zero Trust Engine Integration
        zero_trust_engine:
          enabled: {{ .Values.complianceAutomation.integration.internalSystems.zeroTrustEngine.enabled | default true }}
          endpoint: {{ .Values.complianceAutomation.integration.internalSystems.zeroTrustEngine.endpoint | default "http://zero-trust-engine:8080" | quote }}
          
        # HSM Integration
        hsm:
          enabled: {{ .Values.complianceAutomation.integration.internalSystems.hsm.enabled | default true }}
          endpoint: {{ .Values.complianceAutomation.integration.internalSystems.hsm.endpoint | default "http://hsm-integration:8080" | quote }}
    
    # Dashboard Configuration
    dashboard:
      enabled: {{ .Values.complianceAutomation.dashboard.enabled | default true }}
      
      # Dashboard Features
      features:
        compliance_overview: {{ .Values.complianceAutomation.dashboard.features.complianceOverview | default true }}
        risk_heatmap: {{ .Values.complianceAutomation.dashboard.features.riskHeatmap | default true }}
        control_status: {{ .Values.complianceAutomation.dashboard.features.controlStatus | default true }}
        audit_timeline: {{ .Values.complianceAutomation.dashboard.features.auditTimeline | default true }}
        evidence_library: {{ .Values.complianceAutomation.dashboard.features.evidenceLibrary | default true }}
        remediation_tracker: {{ .Values.complianceAutomation.dashboard.features.remediationTracker | default true }}
        
      # Dashboard Access Control
      access_control:
        authentication_required: {{ .Values.complianceAutomation.dashboard.accessControl.authenticationRequired | default true }}
        role_based_access: {{ .Values.complianceAutomation.dashboard.accessControl.roleBasedAccess | default true }}
        
        # User Roles
        roles:
          - name: "compliance_officer"
            permissions:
              - "view_all_reports"
              - "manage_policies"
              - "approve_remediation"
              - "export_evidence"
              
          - name: "security_manager"
            permissions:
              - "view_security_reports"
              - "manage_controls"
              - "view_risk_assessments"
              
          - name: "auditor"
            permissions:
              - "view_audit_reports"
              - "access_evidence"
              - "export_reports"
              
          - name: "executive"
            permissions:
              - "view_executive_dashboard"
              - "view_summary_reports"
              - "approve_major_changes"
      
      # Dashboard Customization
      customization:
        themes: {{ .Values.complianceAutomation.dashboard.customization.themes | default "light,dark" | quote }}
        widgets: {{ .Values.complianceAutomation.dashboard.customization.widgets | default "configurable" | quote }}
        layout: {{ .Values.complianceAutomation.dashboard.customization.layout | default "responsive" | quote }}
        branding: {{ .Values.complianceAutomation.dashboard.customization.branding | default "custom" | quote }}