apiVersion: skaffold/v4beta13
kind: Config
metadata:
  name: alt-foundation
# Default profile optimized for kind local development
build:
  local:
    push: false  # Local development with kind
    useDockerCLI: true
    useBuildkit: true
    concurrency: 0
    tryImportMissing: true
  tagPolicy:
    gitCommit: {}
  artifacts: []
deploy:
  statusCheckDeadlineSeconds: 600
  helm:
    flags:
      install: ['--wait', '--timeout=600s']
      upgrade: ['--wait', '--timeout=600s']
    releases:
      # MetalLB disabled for security-first approach (ClusterIP + NetworkPolicy)
      # - name: metallb
      #   chartPath: charts/metallb
      #   namespace: metallb-system
      #   createNamespace: true
      #   valuesFiles:
      #     - charts/metallb/values.yaml
      #   version: 0.1.0
      - name: cert-manager
        chartPath: charts/cert-manager
        valuesFiles:
          - charts/cert-manager/values-dev.yaml
          - charts/cert-manager/values.yaml
        version: 0.1.0
        createNamespace: true
        namespace: cert-manager
        setValues:
          installCRDs: true  # Kind environment needs CRDs
      - name: common-config
        chartPath: charts/common-config
        namespace: alt-config
        createNamespace: true
        valuesFiles:
          - charts/common-config/values-development.yaml
          - charts/common-config/values.yaml
        version: 0.1.0
      - name: common-secrets-apps
        chartPath: charts/common-secrets-apps
        namespace: alt-apps
        createNamespace: true
        valuesFiles:
          - charts/common-secrets-apps/values-development.yaml
          - charts/common-secrets-apps/values.yaml
        version: 2.0.0
      - name: ca-issuer
        chartPath: charts/ca-issuer
        namespace: cert-manager
        version: 0.1.0
      - name: network-policies
        chartPath: charts/network-policies
        namespace: default # This namespace is arbitrary as the chart creates resources in other namespaces
        version: 0.1.0
profiles:
  - name: prod
    build:
      local:
        push: false
        useDockerCLI: false  # Docker API使用 (production最適化)
        concurrency: 1  # Local build安定性向上
      tagPolicy:
        gitCommit: {}
      artifacts: []
    deploy:
      statusCheckDeadlineSeconds: 600
      helm:
        flags:
          install: ['--wait', '--timeout=600s']
          upgrade: ['--wait', '--timeout=600s']
        releases:
          # MetalLB disabled for security-first approach (ClusterIP + NetworkPolicy)
          # - name: metallb
          #   chartPath: charts/metallb
          #   namespace: metallb-system
          #   createNamespace: true
          #   valuesFiles:
          #     - charts/metallb/values.yaml
          #   version: 0.1.0
          - name: cert-manager
            chartPath: charts/cert-manager
            namespace: cert-manager
            createNamespace: true
            valuesFiles:
              - charts/cert-manager/values.yaml
            setValues:
              installCRDs: true
            version: 0.1.0
          - name: common-config
            chartPath: charts/common-config
            namespace: alt-config
            createNamespace: true
            valuesFiles:
              - charts/common-config/values-production.yaml
              - charts/common-config/values.yaml
            version: 0.1.0
          - name: common-secrets-apps
            chartPath: charts/common-secrets-apps
            namespace: alt-apps
            createNamespace: true
            valuesFiles:
              - charts/common-secrets-apps/values-production.yaml
              - charts/common-secrets-apps/values.yaml
            version: 2.0.0
          - name: ca-issuer
            chartPath: charts/ca-issuer
            namespace: cert-manager
            version: 0.1.0
          - name: network-policies
            chartPath: charts/network-policies
            namespace: default # This namespace is arbitrary as the chart creates resources in other namespaces
            version: 0.1.0
