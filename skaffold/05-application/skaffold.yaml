apiVersion: skaffold/v4beta13
kind: Config
metadata:
  name: alt-application
# Default profile optimized for kind local development
build:
  local:
    push: false # Local development with kind
    useDockerCLI: true
    useBuildkit: true
    concurrency: 2
    tryImportMissing: true
  tagPolicy:
    gitCommit: {}
  artifacts:
    - image: alt-frontend
      context: ../../alt-frontend
      docker:
        dockerfile: Dockerfile.frontend
profiles:
  - name: dev
    deploy:
      statusCheckDeadlineSeconds: 900
      helm:
        flags:
          install: ["--wait", "--timeout=900s", "--atomic"]
          upgrade: ["--wait", "--timeout=900s", "--atomic"]
        releases:
          - name: alt-frontend
            chartPath: charts/alt-frontend
            namespace: alt-apps
            createNamespace: true
            valuesFiles:
              - charts/alt-frontend/values-development.yaml
              - charts/alt-frontend/values.yaml
            setValueTemplates:
              image.repository: "{{.IMAGE_REPO_alt_frontend}}"
              image.tag: "{{.IMAGE_TAG_alt_frontend}}"
            setValues:
              image.pullPolicy: "Never"
            version: 0.1.0
          - name: nginx
            chartPath: charts/nginx
            namespace: alt-ingress
            createNamespace: true
            valuesFiles:
              - charts/nginx/values.yaml
            version: 0.1.0
          - name: nginx-external
            chartPath: charts/nginx-external
            namespace: alt-ingress
            createNamespace: true
            valuesFiles:
              - charts/nginx-external/values.yaml
            recreatePods: false
            version: 0.1.0
          - name: nginx-certs
            chartPath: charts/nginx-certs
            namespace: alt-ingress
            version: 0.1.0
          - name: nginx-network-policy
            chartPath: charts/nginx-network-policy
            namespace: alt-ingress
            version: 0.1.0
  - name: prod
    build:
      local:
        push: false
        useDockerCLI: false
        concurrency: 1
      tagPolicy:
        gitCommit: {}
      artifacts:
        - image: kaikei/alt-frontend
          context: ../../alt-frontend
          docker:
            dockerfile: Dockerfile.frontend
    deploy:
      statusCheckDeadlineSeconds: 900
      helm:
        flags:
          install: ["--wait", "--timeout=900s", "--atomic"]
          upgrade: ["--wait", "--timeout=900s", "--atomic"]
        releases:
          - name: alt-frontend
            chartPath: charts/alt-frontend
            namespace: alt-apps
            createNamespace: true
            valuesFiles:
              - charts/alt-frontend/values.yaml
              - charts/alt-frontend/values-production.yaml
            setValueTemplates:
              image.repository: "{{.IMAGE_REPO_kaikei_alt_frontend}}"
              image.tag: "{{.IMAGE_TAG_kaikei_alt_frontend}}"
            setValues:
              image.pullPolicy: "Never"
            version: 0.1.0
          - name: nginx
            chartPath: charts/nginx
            namespace: alt-ingress
            createNamespace: true
            valuesFiles:
              - charts/nginx/values.yaml
              - charts/nginx/values-production.yaml
            version: 0.1.0
          - name: nginx-external
            chartPath: charts/nginx-external
            namespace: alt-ingress
            createNamespace: true
            valuesFiles:
              - charts/nginx-external/values.yaml
              - charts/nginx-external/values-production.yaml
            version: 0.1.0
          - name: nginx-certs
            chartPath: charts/nginx-certs
            namespace: alt-ingress
            version: 0.1.0
          - name: nginx-network-policy
            chartPath: charts/nginx-network-policy
            namespace: alt-ingress
            version: 0.1.0
