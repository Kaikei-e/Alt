apiVersion: policy.linkerd.io/v1beta1
kind: ServerAuthorization
metadata:
  name: {{ include "auth-service.fullname" . }}-allow-alt-apps
  namespace: {{ .Release.Namespace }}
  labels:
    {{- include "auth-service.labels" . | nindent 4 }}
    linkerd.policy/component: server-authorization
spec:
  server:
    name: {{ include "auth-service.fullname" . }}-http
  client:
    meshTLS:
      identities:
        # TODO.mdで確認された実際のクライアントID（具体的指定）
        - "alt-frontend.alt-apps.serviceaccount.identity.linkerd.cluster.local"
        # 他のalt-appsサービスからのアクセスも許可（必要に応じて）
        - "*.alt-apps.serviceaccount.identity.linkerd.cluster.local"
        # ヘルスチェック用（Kubernetes probe）
        - "default.default.serviceaccount.identity.linkerd.cluster.local"