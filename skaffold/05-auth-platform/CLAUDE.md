# レイヤー05: Auth Platform 概要

## 1. 責務

この`05-auth-platform`レイヤーは、Altプロジェクトにおけるユーザー認証（Authentication）と認可（Authorization）の機能を提供するプラットフォーム全体を管理・デプロイする責務を負います。ユーザーのサインアップ、サインイン、セッション管理、アクセス制御といった、セキュリティ上極めて重要な機能を提供します。

## 2. 管理コンポーネント

`skaffold.yaml`で定義されている主要なHelmリリースは以下の通りです。これらはすべて`alt-auth`ネームスペースに集約され、認証基盤としての一体性を保っています。

| Helmリリース名 | Chartパス | 説明 |
| :--- | :--- | :--- |
| `kratos` | `charts/kratos` | オープンソースのID・ユーザー管理システム **Ory Kratos**。ユーザーアカウント情報の管理、ログイン・登録・パスワードリセットなどの認証フロー、セッション管理の核となるコンポーネントです。 |
| `auth-service` | `charts/auth-service` | Kratosと連携して動作するGo製のカスタム認証サービス。JWTトークンの発行や、プロジェクト固有の認可ロジック（例：特定のリソースへのアクセス権限チェック）などを担当します。 |

## 3. プロファイル

- **`prod`**: このレイヤーでは`prod`プロファイルのみが定義されています。認証プラットフォームはシステムの根幹であり、常に本番環境と同等の安定性・セキュリティが求められるため、`prod`構成に特化しています。

## 4. ビルドアーティファクト

- **`kaikei/alt-authservice`**: `auth-service`のコンテナイメージをビルドします。

## 5. デプロイ戦略

- **コンポーネントの集約**: 認証に関連する`kratos`と`auth-service`を`alt-auth`という専用のネームスペースにデプロイすることで、関心事の分離と管理の容易性を実現しています。
- **確実な状態更新**: Helmのアップグレード時に`--force`や`--reset-values`といったフラグが使用されています。これは、設定変更を確実かつ強制的に適用し、認証基盤の状態を常に意図通りに保つための強力な戦略です。
- **デプロイ前後検証**: デプロイ前には`helm list`で現在のリリース状態を確認し、デプロイ後には`kubectl get pods`で認証プラットフォームを構成するPod群が正常に起動しているかを検証するフックが設定されており、デプロイプロセスの信頼性を高めています。
