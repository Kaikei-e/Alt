# Default values for cloudflare-tunnel.

# Cloudflare parameters - 2025年標準設定
cloudflare:
  # 2025年推奨: tunnel token方式（JWT形式）
  tunnel_token: ""  # 実際のtunnel tokenを設定

  # Legacy credentials方式（互換性のため）
  account: ""        # Account ID
  tunnelId: ""       # Tunnel ID
  secret: ""         # Tunnel Secret

  # Secret名を指定する場合（手動作成時）
  secretName: ""     # 既存secretを使用する場合

image:
  repository: cloudflare/cloudflared
  pullPolicy: IfNotPresent  # Cloudflare公式イメージは外部pull必要
  # If supplied, this overrides "latest"
  tag: ""

replicaCount: 1

imagePullSecrets: []
nameOverride: ""
fullnameOverride: ""

serviceAccount:
  # Annotations to add to the service account
  annotations: {}
  # The name of the service account to use.
  # If not set and create is true, a name is generated using the fullname template
  name: ""

podAnnotations:
  # Linkerd integration - Opaque ports for Cloudflare Tunnel
  config.linkerd.io/opaque-ports: "7844"
podLabels: {}


# Security items for one container. We lock it down.
securityContext:
  allowPrivilegeEscalation: false
  capabilities:
    drop:
    - ALL
  readOnlyRootFilesystem: true

resources:
  limits:
    cpu: 100m
    memory: 128Mi
  requests:
    cpu: 100m
    memory: 128Mi

nodeSelector: {}

tolerations: []

# Default affinity is to spread out over nodes; use this to override.
affinity: {}

# Dynamic IP Range Update Configuration - 恒久対応
dynamicIpUpdate:
  # Enable dynamic IP range updates via CronJob
  enabled: false  # 本番環境では true に設定

  # CronJob schedule (default: every 6 hours)
  schedule: "0 */6 * * *"

  # Image for IP updater (kubectl + curl + jq)
  image:
    repository: bitnami/kubectl
    tag: "latest"
    pullPolicy: IfNotPresent

  # Script URL for cloudflare-ip-fetcher.sh
  scriptUrl: "https://raw.githubusercontent.com/user/repo/main/scripts/cloudflare-ip-fetcher.sh"

  # Whether to update NetworkPolicy automatically
  updateNetworkPolicy: true

  # CronJob configuration
  successfulJobsHistoryLimit: 3
  failedJobsHistoryLimit: 1
  backoffLimit: 3
  activeDeadlineSeconds: 300

  # Logging
  logLevel: "INFO"

  # Security context for IP updater pods
  podSecurityContext:
    runAsNonRoot: true
    runAsUser: 65532
    fsGroup: 65532

  securityContext:
    allowPrivilegeEscalation: false
    capabilities:
      drop:
      - ALL
    readOnlyRootFilesystem: true
    runAsNonRoot: true
    runAsUser: 65532

  # Resources for IP updater
  resources:
    limits:
      cpu: 100m
      memory: 128Mi
    requests:
      cpu: 50m
      memory: 64Mi

  # Node selector for IP updater
  nodeSelector: {}

  # Tolerations for IP updater
  tolerations: []