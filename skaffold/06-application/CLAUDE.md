# レイヤー06: Application 概要

## 1. 責務

この`06-application`レイヤーは、ユーザーが直接対話するインターフェース（UI）と、システムへの外部からのエントリーポイントとなるコンポーネントを管理・デプロイする責務を負います。ユーザー体験の最前線であり、外部からのリクエストを内部サービスへ振り分ける玄関口としての役割も担います。

## 2. 管理コンポーネント

`skaffold.yaml`で定義されている主要なHelmリリースは以下の通りです。

| Helmリリース名 | Chartパス | Namespace | 説明 |
| :--- | :--- | :--- | :--- |
| `alt-frontend` | `charts/alt-frontend` | `alt-apps` | Next.js/Reactで構築されたフロントエンドアプリケーション。ユーザーがブラウザを通じて直接操作するUIを提供します。 |
| `nginx-external` | `charts/nginx-external` | `alt-ingress` | 外部からのHTTP/Sリクエストを受け付けるNginxリバースプロキシ。Cloudflare Tunnelのようなサービスと連携し、外部トラフィックを安全に受け取り、`alt-frontend`などの適切な内部サービスにルーティングします。 |

## 3. プロファイル

- **`dev` (デフォルト)**: ローカル開発環境向け。ローカルでビルドしたイメージを使用することを想定し、`image.pullPolicy`が`Never`に設定されています。
- **`prod`**: 本番環境向け。本番用のコンテナイメージリポジトリ(`kaikei/alt-frontend`)と設定値(`values-production.yaml`)を使用します。

## 4. ビルドアーティファクト

- **`alt-frontend`**: フロントエンドアプリケーションのコンテナイメージをビルドします。`prod`プロファイルでは`kaikei/alt-frontend`という名前でタグ付けされます。

## 5. デプロイ戦略

- **関心事の分離**: ユーザー向けUI(`alt-frontend`)は`alt-apps`ネームスペースに、外部トラフィックの受け口(`nginx-external`)は`alt-ingress`ネームスペースに分離してデプロイされます。これにより、アプリケーションロジックとネットワークの入り口の役割が明確に分離され、セキュリティと管理性が向上します。
- **アトミックなデプロイ**: Helmの`--atomic`フラグと`--wait`フラグが使用されており、デプロイが失敗した場合には中途半端な状態でリリースが残ることを防ぎ、デプロイが完了するまで待機する、信頼性の高いデプロイプロセスが採用されています。
