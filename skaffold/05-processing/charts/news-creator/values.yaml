# Default values for news-creator
replicaCount: 1

image:
  repository: kaikei/news-creator  # INCIDENT 82 FIX: Core servicesパターン統一
  pullPolicy: IfNotPresent  # INCIDENT 89 FIX: Skaffold auto-transform + digest-source=tag
  # INCIDENT 82 FIX: 固定tag削除 - Skaffold setValueTemplatesで動的tag注入
  # tag: "latest"

service:
  type: ClusterIP
  port: 11434
  targetPort: 11434

resources:
  limits:
    cpu: "2000m"
    memory: "12Gi"  # Increased for gemma3:4b model loading
  requests:
    cpu: "1000m"
    memory: "10Gi"  # Increased base memory

autoscaling:
  enabled: false
  minReplicas: 1
  maxReplicas: 3
  targetCPUUtilizationPercentage: 80

env:
  OLLAMA_NUM_PARALLEL: "1"
  OLLAMA_MAX_LOADED_MODELS: "1"
  OLLAMA_HOME: "/tmp/.ollama"
  HOME: "/tmp"

# Secret configuration
secret:
  create: true
  name: huggingface-secret
  data:
    HF_TOKEN: "dev-token-placeholder"  # Replace with actual HF token

envFromSecret:
  name: huggingface-secret
  keys:
    - HF_TOKEN

serviceAccount:
  create: true
  name: ""
  annotations: {}

configMap:
  create: true
  name: news-creator-config
  data:
    .env: |
      # News Creator Configuration
      PORT=11434
      LOG_LEVEL=info
      OLLAMA_NUM_PARALLEL=1
      OLLAMA_MAX_LOADED_MODELS=2

podSecurityContext:
  runAsUser: 0
  runAsGroup: 0
  fsGroup: 0

securityContext:
  allowPrivilegeEscalation: false
  runAsNonRoot: false
  runAsUser: 0
nodeSelector: {}
tolerations: []
affinity: {}
commonLabels: {}
commonAnnotations: {}
podLabels: {}
podAnnotations: {}
imagePullSecrets: []
volumeMounts:
  - name: ollama-data
    mountPath: /tmp/.ollama
  - name: temp-dir
    mountPath: /tmp/cache

volumes:
  - name: ollama-data
    emptyDir: {}
  - name: temp-dir
    emptyDir: {}

strategy:
  type: RollingUpdate
  rollingUpdate:
    maxUnavailable: 1
    maxSurge: 1

livenessProbe:
  httpGet:
    path: /api/tags
    port: 11434
  failureThreshold: 3
  initialDelaySeconds: 30
  periodSeconds: 30
  timeoutSeconds: 10

readinessProbe:
  httpGet:
    path: /api/tags
    port: 11434
  failureThreshold: 3
  initialDelaySeconds: 15
  periodSeconds: 15
  timeoutSeconds: 5