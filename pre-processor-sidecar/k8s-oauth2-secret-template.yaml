# OAuth2 Token Secret Template for pre-processor-sidecar
# This secret will be managed automatically by the TokenManagementService
# Initial setup requires running oauth-init tool manually

apiVersion: v1
kind: Secret
metadata:
  name: pre-processor-sidecar-oauth2-token
  namespace: alt-processing
  labels:
    app.kubernetes.io/name: pre-processor-sidecar
    app.kubernetes.io/component: oauth2-token
    app.kubernetes.io/part-of: alt-processing
    app.kubernetes.io/managed-by: pre-processor-sidecar
type: Opaque
data:
  # This will be populated by the oauth-init tool and managed by TokenManagementService
  # Fields:
  # - token_data: JSON blob with complete token information
  # - access_token: Base64 encoded access token (for quick reference)
  # - refresh_token: Base64 encoded refresh token (for backup)
  # - expires_at: Base64 encoded ISO8601 timestamp
  
  # Placeholder - will be replaced by oauth-init
  placeholder: cGxhY2Vob2xkZXI=

---
# RBAC permissions for pre-processor-sidecar to manage OAuth2 tokens
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  namespace: alt-processing
  name: pre-processor-sidecar-oauth2
  labels:
    app.kubernetes.io/name: pre-processor-sidecar
    app.kubernetes.io/component: rbac
rules:
- apiGroups: [""]
  resources: ["secrets"]
  resourceNames: ["pre-processor-sidecar-oauth2-token"]
  verbs: ["get", "update", "patch"]
- apiGroups: [""]
  resources: ["secrets"]
  verbs: ["create"]

---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: pre-processor-sidecar-oauth2
  namespace: alt-processing
  labels:
    app.kubernetes.io/name: pre-processor-sidecar
    app.kubernetes.io/component: rbac
subjects:
- kind: ServiceAccount
  name: pre-processor-sidecar
  namespace: alt-processing
roleRef:
  kind: Role
  name: pre-processor-sidecar-oauth2
  apiGroup: rbac.authorization.k8s.io