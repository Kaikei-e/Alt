FROM python:3.12-slim

ENV UV_LINK_MODE=copy \
    PATH="/app/.venv/bin:$PATH"

WORKDIR /app

RUN apt-get update \
 && apt-get install -y --no-install-recommends build-essential gcc g++ libpq-dev \
 && rm -rf /var/lib/apt/lists/*

RUN pip install --no-cache-dir uv==0.9.7

COPY pyproject.toml README.md ./
COPY recap_subworker ./recap_subworker

RUN uv sync --no-dev \
 && uv cache prune || true

EXPOSE 8002

CMD ["uv", "run", "recap-subworker"]
